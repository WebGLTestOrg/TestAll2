System.register("chunks:///_virtual/AddCake.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,r,n,i,o,a,c,s,u;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,n=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.asyncToGenerator,a=t.regeneratorRuntime},function(t){c=t.cclegacy,s=t._decorator,u=t.Component}],execute:function(){var l,p,h,d,f,m,g,y,v;c._RF.push({},"bf9e8dig6dG5784T9aSK/VS","AddCake",void 0);var x=s.ccclass,b=s.property;t("CakeCreator",(l=x("CakeCreator"),p=b({tooltip:"������ URL �� ��������� API (�������� �����)"}),h=b({tooltip:"����. id ������� (�������� 1..N)"}),d=b({tooltip:'��������� �� # ����� ������ (��� � ������� "#999999")'}),l((g=e((m=function(t){function e(){for(var e,r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o))||this,n(e,"endpoint",g,i(e)),n(e,"maxFillingId",y,i(e)),n(e,"hexWithHash",v,i(e)),e}r(e,t);var c=e.prototype;return c.start=function(){this.createCake()},c.createCake=function(){var t=o(a().mark((function t(){var e,r,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.endpoint){t.next=3;break}return console.error("�� ������ endpoint"),t.abrupt("return");case 3:return e={user_id:this.uuidV4(),hex_color:this.randHexColor(this.hexWithHash),name:this.pickRandom(["����","���","����","����","����","������","���"]),title:this.pickRandom(["���������� ����","���������� ����","��������� ����","������� ����","����������� ����"]),greeting_text:this.pickRandom(["����������!","������� � �������!","����� ������� ������������...","����� ���������� �����!","������� �����!"]),filling_id:this.randInt(1,Math.max(1,Math.floor(this.maxFillingId)))},t.prev=4,t.next=7,fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});case 7:return r=t.sent,t.next=10,r.json().catch((function(){return{}}));case 10:n=t.sent,console.log("����� API:",n),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),console.error("������ ��� �������� �����:",t.t0);case 17:case"end":return t.stop()}}),t,this,[[4,14]])})));return function(){return t.apply(this,arguments)}}(),c.pickRandom=function(t){return t[Math.floor(Math.random()*t.length)]},c.randInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},c.randHexColor=function(t){void 0===t&&(t=!0);for(var e=t?"#":"",r=0;r<6;r++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e},c.uuidV4=function(){if("undefined"!=typeof crypto&&"randomUUID"in crypto)return crypto.randomUUID();for(var t=[],e=0;e<16;e++)t.push(Math.floor(256*Math.random()));t[6]=15&t[6]|64,t[8]=63&t[8]|128;var r=t.map((function(t){var e=t.toString(16);return 1===e.length?"0"+e:e})).join("");return r.slice(0,8)+"-"+r.slice(8,12)+"-"+r.slice(12,16)+"-"+r.slice(16,20)+"-"+r.slice(20)},e}(u)).prototype,"endpoint",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),y=e(m.prototype,"maxFillingId",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),v=e(m.prototype,"hexWithHash",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),f=m))||f));c._RF.pop()}}}));

System.register("chunks:///_virtual/ArcTextColorTest.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ClickMoveBinding.ts"],(function(e){var t,n,r,o,i,a,s,c,u,l,p,f,h,d,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized,i=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,c=e._decorator,u=e.Color,l=e.input,p=e.Input,f=e.KeyCode,h=e.Component,d=e.MeshRenderer},function(e){y=e.ClickMoveBinding}],execute:function(){var x,b,v,T,g;s._RF.push({},"45ffd3LcStA75zu5Z71uxN/","ArcTextColorTest",void 0);var C=c.ccclass,k=c.property;e("ArcTextColorTest",(x=C("ArcTextColorTest"),b=k({type:y}),x((g=t((T=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=e.call.apply(e,[this].concat(i))||this,r(t,"binding",g,o(t)),t.startColor=new u(255,0,0,255),t.keyColor=new u(0,255,0,255),t}n(t,e);var s=t.prototype;return s.start=function(){var e=i(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.on(p.EventType.KEY_DOWN,this.onKeyDown,this),e.next=3,this.applyWhenReady();case 3:this.setBoth(this.startColor),console.log("[ArcTextColorTest] старт: покрасили в красный");case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.onDestroy=function(){l.off(p.EventType.KEY_DOWN,this.onKeyDown,this)},s.onKeyDown=function(e){e.keyCode===f.KEY_P&&(this.setBoth(this.keyColor),console.log("[ArcTextColorTest] P: покрасили в зелёный"))},s.setBoth=function(e){var t,n=null==(t=this.binding)?void 0:t.arcText;n&&n.setTextColors(e,e)},s.applyWhenReady=function(){var e=i(a().mark((function e(){var t,n,r,o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null==(t=this.binding)?void 0:t.arcText){e.next=3;break}return e.abrupt("return");case 3:if((r=n.enabled)||(n.enabled=!0),!(o=n.node.getComponent(d))||o.getMaterialInstance(0)&&(!n.text2||o.getMaterialInstance(1))){e.next=10;break}return null==n.rebuildNow||n.rebuildNow(),e.next=10,this.nextFrame();case 10:i=6;case 11:if(!(i-- >0)){e.next=18;break}if(null==o||!o.getMaterialInstance(0)){e.next=14;break}return e.abrupt("break",18);case 14:return e.next=16,this.nextFrame();case 16:e.next=11;break;case 18:!r&&n.freezeAfterBuild&&(n.enabled=!1);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.nextFrame=function(){var e=this;return new Promise((function(t){return e.scheduleOnce((function(){return t()}),0)}))},t}(h)).prototype,"binding",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=T))||v));s._RF.pop()}}}));

System.register("chunks:///_virtual/ArcTextMesh.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,n,r,a,o,l,u,s,f,c,h,p,b,d,m,g,y,x,v;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.createForOfIteratorHelperLoose,o=e.createClass},function(e){l=e.cclegacy,u=e._decorator,s=e.Enum,f=e.JsonAsset,c=e.Texture2D,h=e.Material,p=e.Color,b=e.Layers,d=e.MeshRenderer,m=e.gfx,g=e.Mesh,y=e.math,x=e.Vec3,v=e.Component}],execute:function(){var w,A,M,z,R,_,P,S,C,T,O,L,F,N,D,k,B,G,I,X,J,Y,q,Q,Z,E,j,V,U,H,W,K,$,ee,te,ie,ne,re,ae,oe,le,ue,se,fe,ce,he,pe,be,de,me,ge,ye,xe,ve,we,Ae,Me,ze,Re;l._RF.push({},"28184xX3rNPcJTTJ6RRKcou","ArcTextMesh",void 0);var _e=u.ccclass,Pe=u.property,Se=u.executeInEditMode,Ce=u.disallowMultiple,Te=function(e){return e[e.XY=0]="XY",e[e.XZ=1]="XZ",e[e.YZ=2]="YZ",e}(Te||{});s(Te);var Oe=function(e){return e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right",e}(Oe||{});s(Oe);var Le=function(e){return e[e.Convex=1]="Convex",e[e.Concave=-1]="Concave",e}(Le||{});s(Le);var Fe=function(e){return e[e.Radius=0]="Radius",e[e.ArcAngle=1]="ArcAngle",e}(Fe||{});s(Fe);e("ArcTextMSDFOneLine",(w=_e("ArcTextMSDFOneLine"),A=Se(),M=Ce(),z=Pe({type:f}),R=Pe({type:c}),_=Pe({type:h}),P=Pe({type:p}),S=Pe({tooltip:"true → взять pxRange из JSON"}),C=Pe({tooltip:"Если useJsonPxRange=false"}),T=Pe({tooltip:"Глобальная мягкость края"}),O=Pe({tooltip:"Отсечь ореол"}),L=Pe({tooltip:"Мин. толщина края (px) при даунскейле"}),F=Pe({tooltip:"Гейт усиления AA"}),N=Pe({tooltip:"Поддуть заливку (px)"}),D=Pe({type:Fe}),k=Pe({type:Te}),B=Pe({type:Oe}),G=Pe({type:Le}),I=Pe({slide:!0,range:[2,64],step:1}),X=Pe({slide:!0,range:[1,32],step:1}),J=Pe({slide:!0,range:[1,128],step:1}),Y=Pe({slide:!0,range:[0,240],step:1}),q=Pe({tooltip:"Поставь true → пересборка прямо сейчас"}),w(Q=A(Q=M((E=t((Z=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,n(t,"text",E,r(t)),n(t,"fontJson",j,r(t)),n(t,"atlas",V,r(t)),n(t,"material",U,r(t)),n(t,"pixelScale",H,r(t)),n(t,"spacingScale",W,r(t)),n(t,"color",K,r(t)),n(t,"invertV",$,r(t)),n(t,"mirrorX",ee,r(t)),n(t,"mirrorY",te,r(t)),n(t,"useJsonPxRange",ie,r(t)),n(t,"pxRangeOverride",ne,r(t)),n(t,"msdfSoftness",re,r(t)),n(t,"alphaClip",ae,r(t)),n(t,"minAAMinPx",oe,r(t)),n(t,"minifyGate",le,r(t)),n(t,"fillBiasPx",ue,r(t)),n(t,"bendMode",se,r(t)),n(t,"radius",fe,r(t)),n(t,"arcAngleDeg",ce,r(t)),n(t,"plane",he,r(t)),n(t,"align",pe,r(t)),n(t,"bend",be,r(t)),n(t,"faceOutward",de,r(t)),n(t,"lockRadius",me,r(t)),n(t,"fixedRadius",ge,r(t)),n(t,"pushAlongNormal",ye,r(t)),n(t,"segmentWidthPx",xe,r(t)),n(t,"minSegmentsPerGlyph",ve,r(t)),n(t,"maxSegmentsPerGlyph",we,r(t)),n(t,"editorLiveUpdate",Ae,r(t)),n(t,"buildOnStart",Me,r(t)),n(t,"freezeAfterBuild",ze,r(t)),n(t,"maxRebuildRate",Re,r(t)),t._force=!1,t._lastSig="",t._queued=!1,t._lastAt=0,t._lastMI=null,t._lastMIHash=0,t._fontCache=new Map,t}i(t,e);var l=t.prototype;return l.onLoad=function(){this.node.layer=1<<b.Enum.DEFAULT,this.node.getComponent(d)||this.node.addComponent(d),this._applyToCurrentMI()},l.start=function(){this.buildOnStart&&(this.rebuildNow(!0),this.freezeAfterBuild&&(this.enabled=!1))},l.onValidate=function(){this._applyToCurrentMI()},l.update=function(){},l._signature=function(){var e,t,i,n,r=null!=(e=null==(t=this.fontJson)?void 0:t.uuid)?e:"0",a=this._texSig(this.atlas),o=null!=(i=null==(n=this.material)?void 0:n.uuid)?i:"0";return[this.text,r,a,o,this.pixelScale,this.spacingScale,this.invertV,this.mirrorX,this.mirrorY,this.useJsonPxRange?"J":this.pxRangeOverride,this.msdfSoftness,this.alphaClip,this.minAAMinPx,this.minifyGate,this.fillBiasPx,this.bendMode,this.radius,this.arcAngleDeg,this.plane,this.align,this.bend,this.faceOutward,this.lockRadius,this.fixedRadius,this.pushAlongNormal,this.segmentWidthPx,this.minSegmentsPerGlyph,this.maxSegmentsPerGlyph].join("|")},l._texSig=function(e){var t,i;if(!e)return"0";var n=null!=(t=null!=(i=e._format)?i:e.format)?t:"fmt";return e.width+"x"+e.height+":"+n},l._requestRebuild=function(){var e,t,i=this;if(!this._queued){this._queued=!0;var n=null!=(e=null==(t=globalThis.performance)||null==t.now?void 0:t.now())?e:Date.now(),r=this.maxRebuildRate>0?Math.max(0,this._lastAt+1e3/this.maxRebuildRate-n):0;r<=0?this.scheduleOnce((function(){i._queued=!1,i.rebuildNow()}),0):setTimeout((function(){i.isValid&&i.scheduleOnce((function(){i._queued=!1,i.rebuildNow()}),0)}),r)}},l.rebuildNow=function(e){var t,i;void 0===e&&(e=!1);var n=this._signature();(e||n!==this._lastSig)&&(this._build(),this._lastSig=n,this._lastAt=null!=(t=null==(i=globalThis.performance)||null==i.now?void 0:i.now())?t:Date.now())},l._build=function(){var e=this.node.getComponent(d);if(!(this.text&&this.fontJson&&this.atlas&&this.material))return e.mesh=null,void(e.materials=[]);for(var t=this._buildLine(this.text,this.fontJson,this.atlas,this.pixelScale,this.spacingScale),i=t.positions.length/3,n=new ArrayBuffer(32*i),r=new Float32Array(n),a=0;a<i;a++){var o,l,u,s,f,c=8*a;r[c]=t.positions[3*a],r[c+1]=t.positions[3*a+1],r[c+2]=t.positions[3*a+2],r[c+3]=null!=(o=t.normals[3*a])?o:0,r[c+4]=null!=(l=t.normals[3*a+1])?l:0,r[c+5]=null!=(u=t.normals[3*a+2])?u:1,r[c+6]=null!=(s=t.uvs[2*a])?s:0,r[c+7]=null!=(f=t.uvs[2*a+1])?f:0}var h=new Uint8Array(n),p=new Uint8Array(new Uint32Array(t.indices).buffer),b=new Uint8Array(h.byteLength+p.byteLength);b.set(h,0),b.set(p,h.byteLength);var y=h.byteLength,x=[new m.Attribute(m.AttributeName.ATTR_POSITION,m.Format.RGB32F,!1,0,!1,0),new m.Attribute(m.AttributeName.ATTR_NORMAL,m.Format.RGB32F,!1,0,!1,1),new m.Attribute(m.AttributeName.ATTR_TEX_COORD,m.Format.RG32F,!1,0,!1,2)],v=new g;v.reset({struct:{vertexBundles:[{attributes:x,view:{offset:0,length:h.byteLength,count:i,stride:32}}],primitives:[{primitiveMode:m.PrimitiveMode.TRIANGLE_LIST,vertexBundelIndices:[0],indexView:{offset:y,length:p.byteLength,count:t.indices.length,stride:4}}],minPosition:t.minPos,maxPosition:t.maxPos},data:b}),e.mesh=v,e.materials=[this.material],this._applyToCurrentMI()},l._applyToCurrentMI=function(){var e=this.node.getComponent(d);if(e){var t=e.getMaterialInstance(0);t&&this._applyMatProps(t,this.fontJson,this.atlas,this.color)}},l._buildLine=function(e,t,i,n,r){for(var o,l,u=this,s=this._getFont(t),f=s.glyphMap,c=s.kernMap,h=function(e,t){var i;return null!=(i=c.get(e<<16|t))?i:0},p=Math.max(1e-4,n),b=Math.max(1,i.width),d=Math.max(1,i.height),m=null!=(o=s.common.base)?o:Math.round(.5*(s.common.lineHeight||0)),g=m*p,v=[],w=0,A=1e9,M=-1e9,z=[],R=a(e);!(l=R()).done;){var _=l.value;z.push(_.codePointAt(0))}for(var P=0;P<z.length;P++){var S,C=null!=(S=f.get(z[P]))?S:f.get(63);if(C){var T=(C.xadvance+(P>0?h(z[P-1],C.id):0))*p*r,O=w+C.xoffset*p,L=O+C.width*p,F=(m-C.yoffset)*p,N=F-C.height*p;v.push({g:C,left:O,right:L,yTop:F,yBot:N}),O<A&&(A=O),L>M&&(M=L),w+=T}}var D=Math.max(1e-4,M-A),k=0,B=this.radius;if(this.lockRadius)B=Math.max(.001,this.fixedRadius),k=D/B;else if(this.bendMode===Fe.Radius)B=Math.max(.001,this.radius),k=D/B;else{var G=y.toRadian(this.arcAngleDeg);k=Math.max(0,G),B=k<1e-6?1e12:D/k}var I=0;this.align===Oe.Center?I=-k/2:this.align===Oe.Right&&(I=-k);for(var X=this.bend===Le.Convex?1:-1,J=new x,Y=new x,q=new y.Quat,Q=new y.Quat,Z=function(e,t,i){switch(u.plane){case Te.XY:i.set(Math.cos(e)*t,Math.sin(e)*t,0);break;case Te.XZ:i.set(Math.cos(e)*t,0,Math.sin(e)*t);break;case Te.YZ:i.set(0,Math.cos(e)*t,Math.sin(e)*t)}},E=function(e,t){var i=u.faceOutward?90:0;switch(u.plane){case Te.XY:y.Quat.fromEuler(t,0,0,e+i);break;case Te.XZ:y.Quat.fromEuler(t,0,-(e+i),0);break;case Te.YZ:y.Quat.fromEuler(t,e+i,0,0)}},j=k<1e-6?new x(A+.5*D,g,0):function(){var e=new x;return Z((I+.5*k)*X,B,e),e}(),V=this.plane===Te.XY?new x(0,0,1):this.plane===Te.XZ?new x(0,1,0):new x(1,0,0),U=new x,H=new x,W=[],K=[],$=[],ee=[],te=new x,ie=new x,ne=new x,re=new x,ae=new x,oe=new x,le=this.pushAlongNormal,ue=0,se=v;ue<se.length;ue++){var fe=se[ue],ce=fe.g,he=Math.max(1e-4,ce.width*p),pe=Math.ceil(ce.width/Math.max(1,Math.floor(this.segmentWidthPx)));pe=Math.max(this.minSegmentsPerGlyph,Math.min(this.maxSegmentsPerGlyph,pe));for(var be=0;be<pe;be++){var de=be/pe,me=(be+1)/pe,ge=fe.left+he*de,ye=fe.left+he*me,xe=(I+(ge-A)/D*k)*X,ve=(I+(ye-A)/D*k)*X;Z(xe,B,J),Z(ve,B,Y),E(y.toDegree(xe),q),E(y.toDegree(ve),Q),ae.set(ge,g,0),oe.set(ye,g,0),te.set(ge,fe.yTop,0),ie.set(ge,fe.yBot,0),ne.set(ye,fe.yTop,0),re.set(ye,fe.yBot,0);var we=new x(te.x-ae.x,te.y-ae.y,0);x.transformQuat(we,we,q),we.add(J).subtract(j);var Ae=new x(ie.x-ae.x,ie.y-ae.y,0);x.transformQuat(Ae,Ae,q),Ae.add(J).subtract(j);var Me=new x(ne.x-oe.x,ne.y-oe.y,0);x.transformQuat(Me,Me,Q),Me.add(Y).subtract(j);var ze=new x(re.x-oe.x,re.y-oe.y,0);x.transformQuat(ze,ze,Q),ze.add(Y).subtract(j),x.transformQuat(U,V,q),x.transformQuat(H,V,Q),0!==le&&(we.x+=U.x*le,we.y+=U.y*le,we.z+=U.z*le,Me.x+=H.x*le,Me.y+=H.y*le,Me.z+=H.z*le,ze.x+=H.x*le,ze.y+=H.y*le,ze.z+=H.z*le,Ae.x+=U.x*le,Ae.y+=U.y*le,Ae.z+=U.z*le);var Re=(ce.x+ce.width*de)/b,_e=(ce.x+ce.width*me)/b,Pe=ce.y/d,Se=(ce.y+ce.height)/d;if(this.invertV){var Ce=Pe;Pe=Se,Se=Ce}if(this.mirrorX){var Ne=Re;Re=_e,_e=Ne}if(this.mirrorY){var De=Pe;Pe=Se,Se=De}var ke=W.length/3;W.push(we.x,we.y,we.z,Me.x,Me.y,Me.z,ze.x,ze.y,ze.z,Ae.x,Ae.y,Ae.z),K.push(U.x,U.y,U.z,H.x,H.y,H.z,H.x,H.y,H.z,U.x,U.y,U.z),$.push(Re,Pe,_e,Pe,_e,Se,Re,Se),ee.push(ke,ke+1,ke+2,ke,ke+2,ke+3)}}for(var Be=new x(1e9,1e9,1e9),Ge=new x(-1e9,-1e9,-1e9),Ie=0;Ie<W.length;Ie+=3){var Xe=W[Ie],Je=W[Ie+1],Ye=W[Ie+2];Xe<Be.x&&(Be.x=Xe),Je<Be.y&&(Be.y=Je),Ye<Be.z&&(Be.z=Ye),Xe>Ge.x&&(Ge.x=Xe),Je>Ge.y&&(Ge.y=Je),Ye>Ge.z&&(Ge.z=Ye)}return{positions:W,normals:K,uvs:$,indices:ee,minPos:Be,maxPos:Ge}},l.applyApiData=function(e){var t=function(e){if(!e||"object"!=typeof e)return null;for(var t=0,i=["text","value","label","name","title"];t<i.length;t++){var n=e[i[t]];if(null!=n)return String(n)}return null},i=null;if(null==e)i="";else if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)i=String(e);else if(Array.isArray(e))i=e.map((function(e){if(null==e)return"";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return String(e);var i=t(e);return null!=i?i:String(e)})).join("");else if("object"==typeof e){var n;i=null!=(n=t(e))?n:String(e)}return null!=i&&(i=i.replace(/\r\n/g,"\n").trim(),this.text!==i&&(this.text=i,this._requestRebuild(),!0))},l._applyMatProps=function(e,t,i,n){var r=function(t,i){if(!function(e,t){var i,n,r,o,l,u=e.effectAsset;if(null==u||null==(i=u.techniques)||!i.length)return!1;var s=null!=(n=null!=(r=e._techIdx)?r:e.technique)?n:0,f=null!=(o=u.techniques[s])?o:u.techniques[0];if(null==f||null==(l=f.passes)||!l.length)return!1;for(var c,h=a(f.passes);!(c=h()).done;){var p=c.value,b=null==p?void 0:p.properties;if(b&&Object.prototype.hasOwnProperty.call(b,t))return!0}return!1}(e,t))return!1;try{return e.setProperty(t,i),!0}catch(e){return!1}},o=this.pxRangeOverride;if(this.useJsonPxRange&&t){var l=this._getFont(t);null!=(null==l?void 0:l.distanceRange)&&(o=l.distanceRange)}i&&r("mainTexture",i),r("tintColor",this.color),r("pxRange",o),r("softness",this.msdfSoftness),r("alphaClip",this.alphaClip),r("minAAMinPx",this.minAAMinPx),r("minifyGate",this.minifyGate),r("fillBiasPx",this.fillBiasPx)},l._getFont=function(e){var t,i;if(!e)return null;var n=null!=(t=e.uuid)?t:String(e),r=this._fontCache.get(n);if(r)return r;var o=e.json,l=new Map;if(Array.isArray(o.chars))for(var u,s=a(o.chars);!(u=s()).done;){var f=u.value;l.set(f.id,f)}else for(var c in o.chars)l.set(Number(c),o.chars[c]);var h=new Map;if(Array.isArray(o.kernings))for(var p,b=a(o.kernings);!(p=b()).done;){var d=p.value;h.set(d.first<<16|d.second,d.amount)}else if(o.kernings)for(var m in o.kernings)h.set(Number(m),o.kernings[m]);var g={glyphMap:l,kernMap:h,common:o.common,distanceRange:null==(i=o.distanceField)?void 0:i.distanceRange};return this._fontCache.set(n,g),g},l.setText=function(e){this.text=null!=e?e:"",this._requestRebuild()},l.setColor=function(e){this.color=e,this._applyToCurrentMI()},o(t,[{key:"Force_Rebuild",get:function(){return this._force},set:function(e){e&&this.rebuildNow(!0),this._force=!1}}]),t}(v)).prototype,"text",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Текст"}}),j=t(Z.prototype,"fontJson",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(Z.prototype,"atlas",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=t(Z.prototype,"material",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H=t(Z.prototype,"pixelScale",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),W=t(Z.prototype,"spacingScale",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),K=t(Z.prototype,"color",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p(255,255,255,255)}}),$=t(Z.prototype,"invertV",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ee=t(Z.prototype,"mirrorX",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),te=t(Z.prototype,"mirrorY",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ie=t(Z.prototype,"useJsonPxRange",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ne=t(Z.prototype,"pxRangeOverride",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),re=t(Z.prototype,"msdfSoftness",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.25}}),ae=t(Z.prototype,"alphaClip",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.04}}),oe=t(Z.prototype,"minAAMinPx",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.75}}),le=t(Z.prototype,"minifyGate",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),ue=t(Z.prototype,"fillBiasPx",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),se=t(Z.prototype,"bendMode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fe.ArcAngle}}),fe=t(Z.prototype,"radius",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ce=t(Z.prototype,"arcAngleDeg",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),he=t(Z.prototype,"plane",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Te.XZ}}),pe=t(Z.prototype,"align",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Oe.Center}}),be=t(Z.prototype,"bend",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Le.Concave}}),de=t(Z.prototype,"faceOutward",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),me=t(Z.prototype,"lockRadius",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ge=t(Z.prototype,"fixedRadius",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),ye=t(Z.prototype,"pushAlongNormal",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xe=t(Z.prototype,"segmentWidthPx",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),ve=t(Z.prototype,"minSegmentsPerGlyph",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),we=t(Z.prototype,"maxSegmentsPerGlyph",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),Ae=t(Z.prototype,"editorLiveUpdate",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Me=t(Z.prototype,"buildOnStart",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ze=t(Z.prototype,"freezeAfterBuild",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Re=t(Z.prototype,"maxRebuildRate",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),t(Z.prototype,"Force_Rebuild",[q],Object.getOwnPropertyDescriptor(Z.prototype,"Force_Rebuild"),Z.prototype),Q=Z))||Q)||Q)||Q));l._RF.pop()}}}));

System.register("chunks:///_virtual/AutoScaleCameraPosition.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,a,r,s,o,n,h,l,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,a=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){s=e.cclegacy,o=e._decorator,n=e.Vec3,h=e.Size,l=e.view,c=e.Component}],execute:function(){var u,m,d,f,g,_,F,p,w;s._RF.push({},"127bfVhJ3NP/LBgnQxROUZd","AutoScaleCameraPosition",void 0);var b=o.ccclass,x=o.property;e("AutoScaleCameraZ_OnResizeOnly",(u=b("AutoScaleCameraZ_OnResizeOnly"),m=x({tooltip:"Опционально для логов"}),d=x({tooltip:"Агрегация масштаба: average/min/max"}),f=x({tooltip:"Включить логи (логирует только при изменении размера)"}),u((F=t((_=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return t=e.call.apply(e,[this].concat(s))||this,a(t,"refResolution",F,r(t)),a(t,"scaleMode",p,r(t)),a(t,"debugLogs",w,r(t)),t._basePos=new n,t._refFrame=new h(1,1),t._lastFrame=new h(0,0),t._lastScale=0,t}i(t,e);var s=t.prototype;return s.onEnable=function(){this._basePos.set(this.node.position);var e=l.getFrameSize();this._refFrame.width=Math.max(1,e.width),this._refFrame.height=Math.max(1,e.height),this._lastFrame.width=e.width,this._lastFrame.height=e.height,this.debugLogs&&console.log("[AutoScaleCameraZ_OnResizeOnly] basePos=",this._basePos," refFrame=",this._refFrame.width+"x"+this._refFrame.height),this._applyForFrame(e.width,e.height,"initial")},s.update=function(){var e=l.getFrameSize();e.width===this._lastFrame.width&&e.height===this._lastFrame.height||(this._lastFrame.width=e.width,this._lastFrame.height=e.height,this._applyForFrame(e.width,e.height,"resize"))},s._applyForFrame=function(e,t,i){var a=e/this._refFrame.width,r=t/this._refFrame.height,s=1;switch(this.scaleMode){case"min":s=Math.min(a,r);break;case"max":s=Math.max(a,r);break;default:s=.5*(a+r)}var o=this._basePos.z,n=o/(s||1);n<o&&(n=o),this.node.setPosition(this._basePos.x,this._basePos.y,n),this.debugLogs&&console.log("[AutoScaleCameraZ_OnResizeOnly]","\n  source  = "+i,"\n  frame   = "+e+"x"+t,"\n  refFrm  = "+this._refFrame.width+"x"+this._refFrame.height,"\n  refRes  = "+this.refResolution.width+"x"+this.refResolution.height,"\n  scaleX  = "+a.toFixed(4)+"  scaleY = "+r.toFixed(4)+"  mode="+this.scaleMode,"\n  scale   = "+s.toFixed(4)+"  (prev="+this._lastScale.toFixed(4)+")","\n  z0      = "+o.toFixed(3)+"  zRaw="+(o/(s||1)).toFixed(3)+"  => zNew="+n.toFixed(3),"\n  (resized ✅)"),this._lastScale=s},t}(c)).prototype,"refResolution",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h(1920,1080)}}),p=t(_.prototype,"scaleMode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"average"}}),w=t(_.prototype,"debugLogs",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),g=_))||g));s._RF.pop()}}}));

System.register("chunks:///_virtual/cake.types.ts",["cc"],(function(){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"62c0b/lKX5EKIeXadjVtKpv","cake.types",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/CakeApiExample.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,t,n,i,a,u;return{setters:[function(e){r=e.inheritsLoose,t=e.asyncToGenerator,n=e.regeneratorRuntime},function(e){i=e.cclegacy,a=e._decorator,u=e.Component}],execute:function(){var o;i._RF.push({},"7844ftwvDpJ44g6amQ0vR1m","CakeApiExample",void 0);var s=a.ccclass;e("CakeApiExample",s("CakeApiExample")(o=function(e){function i(){return e.apply(this,arguments)||this}return r(i,e),i.prototype.start=function(){var e=t(n().mark((function e(){var r,t,i,a,u,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://api.demo-stage.ru/cake/list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});case 3:if((r=e.sent).ok){e.next=10;break}return e.next=7,l(r);case 7:return t=e.sent,console.error("Ошибка запроса:",r.status,t),e.abrupt("return");case 10:return e.next=12,r.json().catch((function(){return null}));case 12:if(i=e.sent,console.log("Сырой ответ API:",i),a=Array.isArray(i)?i:Array.isArray(null==i?void 0:i.cakes)?i.cakes:Array.isArray(null==i?void 0:i.items)?i.items:Array.isArray(null==i?void 0:i.data)?i.data:Array.isArray(null==i?void 0:i.result)?i.result:[],Array.isArray(a)&&0!==a.length){e.next=19;break}return u=i&&"object"==typeof i?Object.keys(i):[],console.warn("Не нашли массив элементов. Ключи корня ответа:",u),e.abrupt("return");case 19:o=a.map((function(e,r){var t=_(e);return t.user_id||console.warn("[item "+r+"] user_id отсутствует или не UUID. Исходное:",f(e,"user_id","uniq_id","userId","userID","user.id","attributes.user_id","attributes.userId")),t.hex_color||console.warn("[item "+r+"] hex_color отсутствует или не HEX. Исходное:",f(e,"hex_color","hexColor","color","attributes.hex_color","attributes.color")),t})),console.log("Нормализованные элементы (отсутствующие поля = null):",o);try{console.table(o.map((function(e,r){return{"#":r,user_id:e.user_id,hex_color:e.hex_color,name:e.name,title:e.title,greeting_text:e.greeting_text,filling_id:e.filling_id,file_present:e.file?"yes":"no"}})))}catch(e){}e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.error("Ошибка соединения:",e.t0);case 27:case"end":return e.stop()}}),e,null,[[0,24]])})));return function(){return e.apply(this,arguments)}}(),i}(u))||o);function l(e){return c.apply(this,arguments)}function c(){return(c=t(n().mark((function e(r){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.text();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return","");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function f(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];for(var i=0,a=t;i<a.length;i++){var u=a[i],o=u.split(".").reduce((function(e,r){return e?e[r]:void 0}),e);if(void 0!==o)return o}}function p(e){if("string"==typeof e){var r=e.trim();return r.length?r:null}return null}function d(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){var r=e.trim();if(""===r)return null;var t=Number(r);return Number.isFinite(t)?t:null}return null}function _(e){var r,t=f(e,"user_id","uniq_id","userId","userID","user.id","attributes.user_id","attributes.userId"),n=f(e,"hex_color","hexColor","color","attributes.hex_color","attributes.color"),i=f(e,"name","nickname","user_name","attributes.name"),a=f(e,"title","label","attributes.title"),u=f(e,"greeting_text","greetingText","greeting","attributes.greeting_text"),o=f(e,"filling_id","fillingId","attributes.filling_id"),s=f(e,"file","file_base64","attributes.file"),l=p(t);l&&(r=l.trim(),!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(r))&&(console.warn("user_id не прошёл UUID-проверку → null:",l),l=null);var c=p(n);return c&&function(e){return/^#?([0-9a-f]{3}|[0-9a-f]{6})$/i.test(e.trim())}(c)?c=function(e){var r=(e.startsWith("#")?e.slice(1):e).trim().toLowerCase();return 3===r.length?"#"+r.split("").map((function(e){return e+e})).join("").toUpperCase():6===r.length?"#"+r.toUpperCase():r?"#"+r.slice(0,6).toUpperCase():"#000000"}(c):(c&&console.warn("hex_color не прошёл HEX-проверку → null:",c),c=null),{user_id:l,hex_color:c,name:p(i),title:p(a),greeting_text:p(u),filling_id:d(o),file:p(s)}}i._RF.pop()}}}));

System.register("chunks:///_virtual/CameraTuner.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,a,n,o,l,u,p,s;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){n=e.cclegacy,o=e._decorator,l=e.Camera,u=e.Node,p=e.EditBox,s=e.Component}],execute:function(){var c,m,f,h,b,g,y,v,d,D,w,z,P,X,Z,C,F,x,N,T,B;n._RF.push({},"c3cf46KIGlMI5X2BRz/vNd6","CameraTuner",void 0);var R=o.ccclass,O=o.property;e("CameraTuner",(c=R("CameraTuner"),m=O({type:l,tooltip:"������, ������� �����������"}),f=O({type:u,tooltip:"�������� ������ (���� �� ������ � ������ parent � camera.node)"}),h=O({tooltip:"Z-������� �������� ������ (���������)"}),b=O({tooltip:"������� ������ �� X (� ��������)"}),g=O({tooltip:"���� ������ ������ FOV (� ��������, 1�170)"}),y=O({tooltip:"��������� ��������� ��� ������ �����"}),v=O({type:p,tooltip:"EditBox ��� ����� Z ��������"}),d=O({type:p,tooltip:"EditBox ��� ����� X-�������� (deg)"}),D=O({type:p,tooltip:"EditBox ��� ����� FOV (deg)"}),c((P=t((z=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return t=e.call.apply(e,[this].concat(n))||this,i(t,"camera",P,a(t)),i(t,"cameraParent",X,a(t)),i(t,"parentZ",Z,a(t)),i(t,"rotationXDeg",C,a(t)),i(t,"fovDeg",F,a(t)),i(t,"applyOnStart",x,a(t)),i(t,"uiParentZ",N,a(t)),i(t,"uiRotX",T,a(t)),i(t,"uiFov",B,a(t)),t}r(t,e);var n=t.prototype;return n.onLoad=function(){!this.cameraParent&&this.camera&&(this.cameraParent=this.camera.node.parent||null)},n.start=function(){this.applyOnStart&&this.applyValues(this.parentZ,this.rotationXDeg,this.fovDeg)},n.applyValues=function(e,t,r){if(this.camera){var i=this.cameraParent;if(i){var a=i.getPosition();i.setPosition(a.x,a.y,e)}else console.warn("[CameraTuner] �������� ������ �� ������");var n=this.camera.node.eulerAngles.clone();n.x=t,this.camera.node.eulerAngles=n;var o=Math.min(170,Math.max(1,r));this.camera.fov=o,this.parentZ=e,this.rotationXDeg=t,this.fovDeg=o}else console.warn("[CameraTuner] Camera �� ���������")},n.onApplyFromUI=function(){var e,t,r,i=this.parseNumber(null==(e=this.uiParentZ)?void 0:e.string,this.parentZ),a=this.parseNumber(null==(t=this.uiRotX)?void 0:t.string,this.rotationXDeg),n=this.parseNumber(null==(r=this.uiFov)?void 0:r.string,this.fovDeg);this.applyValues(i,a,n)},n.parseNumber=function(e,t){if(null==e)return t;var r=Number(e.replace(",","."));return Number.isFinite(r)?r:t},t}(s)).prototype,"camera",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X=t(z.prototype,"cameraParent",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z=t(z.prototype,"parentZ",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C=t(z.prototype,"rotationXDeg",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),F=t(z.prototype,"fovDeg",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),x=t(z.prototype,"applyOnStart",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),N=t(z.prototype,"uiParentZ",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=t(z.prototype,"uiRotX",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=t(z.prototype,"uiFov",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=z))||w));n._RF.pop()}}}));

System.register("chunks:///_virtual/ClickMoveBinding.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ArcTextMesh.ts"],(function(e){var t,n,i,r,a,l,o,u,s,c,p,h,f,b,m,d,v,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.createForOfIteratorHelperLoose,l=e.createClass,o=e.asyncToGenerator,u=e.regeneratorRuntime},function(e){s=e.cclegacy,c=e._decorator,p=e.Node,h=e.MeshRenderer,f=e.Animation,b=e.tween,m=e.Vec3,d=e.Component,v=e.ParticleSystem},function(e){g=e.ArcTextMSDFOneLine}],execute:function(){var y,_,A,w,P,D,S,H,T,x,z,C,k,M,B,R,O,N,q,F,j,L,V,E,I,G,W,J;s._RF.push({},"a3b9f30vchC9aP2MSuw/5Bg","ClickMoveBinding",void 0);var K=c.ccclass,Q=c.property;e("ClickMoveBinding",(y=K("ClickMoveBinding"),_=Q({type:p}),A=Q({type:h}),w=Q({type:p}),P=Q({type:p}),D=Q({type:g}),S=Q({type:p,tooltip:"Объект c партиклом для выезда кусочка"}),H=Q({type:p}),T=Q({type:[p]}),x=Q({type:p}),z=Q({type:[p]}),y((M=t((k=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return t=e.call.apply(e,[this].concat(a))||this,i(t,"target",M,r(t)),i(t,"meshRenderer",B,r(t)),i(t,"model",R,r(t)),i(t,"rim",O,r(t)),i(t,"arcText",N,r(t)),i(t,"pullParticleObject",q,r(t)),t._startTargetPos=null,t._startModelEuler=null,t._captured=!1,i(t,"main",F,r(t)),i(t,"candles",j,r(t)),i(t,"candleAnimatorHubNode",L,r(t)),i(t,"berries",V,r(t)),i(t,"mainDuration",E,r(t)),i(t,"mainDurationHide",I,r(t)),i(t,"candleDuration",G,r(t)),i(t,"candleDelayBetween",W,r(t)),i(t,"berriesDuration",J,r(t)),t._runningTweens=[],t._hubAnims=[],t}n(t,e);var s=t.prototype;return s.onEnable=function(){this.ensureCaptured()},s.ensureCaptured=function(){this._captured||(this.target&&(this._startTargetPos=this.target.getPosition().clone()),this.model&&(this._startModelEuler=this.model.eulerAngles.clone()),this._captured=!!this.target)},s.updateFromApi=function(e){var t=this.arcText;if(t){var n=t.enabled;n||(t.enabled=!0),t.applyApiData(e),"function"==typeof t.rebuildNow&&t.rebuildNow(),!n&&t.freezeAfterBuild&&(t.enabled=!1)}},s.logWorld=function(e){this.target&&console.log("["+e+"] target world pos=",this.target.worldPosition.clone()),this.model&&console.log("["+e+"] model  world pos=",this.model.worldPosition.clone(),"euler=",this.model.eulerAngles.clone())},s.start=function(){this._prepareAnimationState(),this._collectHubAnims()},s.playSequence=function(){var e=o(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopSequence(),this._prepareAnimationState(),e.next=4,this._appearMain();case 4:t=0;case 5:if(!(t<this.candles.length)){e.next=14;break}return e.next=8,this._appearCandle(t);case 8:if(!(this.candleDelayBetween>0&&t<this.candles.length-1)){e.next=11;break}return e.next=11,this._delay(this.candleDelayBetween);case 11:t++,e.next=5;break;case 14:return e.next=16,this._appearBerriesParallel();case 16:this._enableAndPlayAllHubAnims();case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s._enableAndPlayAllHubAnims=function(){for(var e,t=a(this._hubAnims);!(e=t()).done;){var n=e.value;if(n){n.enabled=!0;try{n.stop(),n.play()}catch(e){}}}},s.playSequenceCloseAndReset=function(){var e=o(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.stopSequence(),this.main&&this.main.active){e.next=4;break}return this.resetVisuals(),e.abrupt("return");case 4:return this.main.active=!0,e.next=7,this._scaleTo(this.main,0,this.mainDurationHide,"backIn");case 7:this.main.active=!1,this.resetVisuals();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.resetVisuals=function(){this.main&&(this.main.active=!1,this.main.setScale(0,0,0));for(var e,t=a(this.candles);!(e=t()).done;){var n=e.value;n&&(n.active=!1,n.setScale(0,0,0))}for(var i,r=a(this.berries);!(i=r()).done;){var l=i.value;l&&(l.active=!1,l.setScale(0,0,0))}this._stopAndDisableAllHubAnims()},s.stopSequence=function(){for(var e,t=a(this._runningTweens);!(e=t()).done;){var n=e.value;try{n.stop()}catch(e){}}this._runningTweens.length=0,this._stopAllHubAnims()},s._prepareAnimationState=function(){this.main&&(this.main.active=!1,this.main.setScale(0,0,0));for(var e,t=a(this.candles);!(e=t()).done;){var n=e.value;n&&(n.active=!1,n.setScale(0,0,0))}for(var i,r=a(this.berries);!(i=r()).done;){var l=i.value;l&&(l.active=!1,l.setScale(0,0,0))}0===this._hubAnims.length?this._collectHubAnims():this._stopAndDisableAllHubAnims()},s._collectHubAnims=function(){if(this._hubAnims=[],this.candleAnimatorHubNode){this._hubAnims=this.candleAnimatorHubNode.getComponents(f)||[];for(var e,t=a(this._hubAnims);!(e=t()).done;){var n=e.value;try{n.stop()}catch(e){}n.enabled=!1}}},s._appearMain=function(){var e=this;return new Promise((function(t){if(!e.main)return t();var n=e.main;n.active=!0,n.setScale(0,0,0);var i=b(n).to(e.mainDuration,{scale:new m(1,1,1)},{easing:"backOut"}).call((function(){return t()})).start();e._runningTweens.push(i)}))},s._appearCandle=function(e){var t=this,n=this.candles[e];return n?new Promise((function(e){n.active=!0,n.setScale(0,0,0);var i=b(n).to(t.candleDuration,{scale:new m(1,1,1)},{easing:"bounceOut"}).call((function(){return e()})).start();t._runningTweens.push(i)})):Promise.resolve()},s._appearBerriesParallel=function(){var e=this,t=this.berries.map((function(t){return t?new Promise((function(n){t.active=!0,t.setScale(0,0,0);var i=b(t).to(e.berriesDuration,{scale:new m(1,1,1)},{easing:"backOut"}).call((function(){return n()})).start();e._runningTweens.push(i)})):Promise.resolve()}));return Promise.all(t).then((function(){}))},s._enableAndPlayHubAnim=function(e){var t=this._hubAnims[e];if(t){t.enabled=!0;try{t.stop(),t.play()}catch(e){}}},s._stopAllHubAnims=function(){for(var e,t=a(this._hubAnims);!(e=t()).done;){var n=e.value;if(n)try{n.stop()}catch(e){}}},s._stopAndDisableAllHubAnims=function(){for(var e,t=a(this._hubAnims);!(e=t()).done;){var n=e.value;if(n){try{n.stop()}catch(e){}n.enabled=!1}}},s._scaleTo=function(e,t,n,i){var r=this;return new Promise((function(a){var l=b(e).to(n,{scale:new m(t,t,t)},{easing:i}).call((function(){return a()})).start();r._runningTweens.push(l)}))},s._delay=function(e){return new Promise((function(t){return setTimeout(t,Math.max(0,1e3*e))}))},s.getPreferredMeshRenderer=function(){var e,t,n;if(this.meshRenderer)return this.meshRenderer;var i=function(e){var t;return null!=(t=null==e?void 0:e.getComponent(h))?t:null};return null!=(e=null!=(t=null!=(n=i(this.model))?n:i(this.rim))?t:this.node.getComponent(h))?e:null},l(t,[{key:"pullParticle",get:function(){var e,t;return null!=(e=null==(t=this.pullParticleObject)?void 0:t.getComponent(v))?e:null}}]),t}(d)).prototype,"target",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(k.prototype,"meshRenderer",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(k.prototype,"model",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=t(k.prototype,"rim",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(k.prototype,"arcText",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(k.prototype,"pullParticleObject",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(k.prototype,"main",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=t(k.prototype,"candles",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),L=t(k.prototype,"candleAnimatorHubNode",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=t(k.prototype,"berries",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),E=t(k.prototype,"mainDuration",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.45}}),I=t(k.prototype,"mainDurationHide",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.45}}),G=t(k.prototype,"candleDuration",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.35}}),W=t(k.prototype,"candleDelayBetween",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),J=t(k.prototype,"berriesDuration",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.35}}),C=k))||C));s._RF.pop()}}}));

System.register("chunks:///_virtual/ColorLibrary.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,i,a,o,l,u,s,p,c,h,d,f,m,x,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.initializerDefineProperty,n=e.inheritsLoose,i=e.assertThisInitialized,a=e.createForOfIteratorHelperLoose,o=e.createClass,l=e.asyncToGenerator,u=e.regeneratorRuntime},function(e){s=e.cclegacy,p=e._decorator,c=e.Color,h=e.Texture2D,d=e.director,f=e.ImageAsset,m=e.MeshRenderer,x=e.Component,b=e.assetManager}],execute:function(){var y,T,v,g,w,_,M,k,U,I,R,C,P,A,S,z,N,F,L,q,E,B,D,O,j,G,H,W,J,K,$,Q,V,X,Y,Z,ee,te,re;s._RF.push({},"8daf7NAKxNJnqCgflAGm7av","ColorLibrary",void 0);var ne=p.ccclass,ie=p.property,ae=e("ThemeDef",(y=ne("ThemeDef"),T=ie({tooltip:"Имя темы (совпадает с hex_color из API)"}),v=ie({type:c,tooltip:"Цвет #1 (для mat0)"}),g=ie({type:c,tooltip:"Цвет #2 (для mat0)"}),w=ie({type:h,tooltip:"БОКОВАЯ текстура (для mat1)"}),_=ie({type:c,tooltip:"Цвет текста (MSDF tint, u:tintColor)"}),y((U=t((k=function(){r(this,"name",U,this),r(this,"color1",I,this),r(this,"color2",R,this),r(this,"sideTexture",C,this),r(this,"textColor",P,this)}).prototype,"name",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),I=t(k.prototype,"color1",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new c(255,255,255,255)}}),R=t(k.prototype,"color2",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new c(0,0,0,255)}}),C=t(k.prototype,"sideTexture",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=t(k.prototype,"textColor",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new c(255,255,255,255)}}),M=k))||M));e("ColorTextureLibrary",(A=ne("ColorTextureLibrary"),S=ie({type:[ae],tooltip:"Список тем"}),z=ie({type:[h],tooltip:"Глобальный список паттернов (для mat0)"}),N=ie({tooltip:"Материал ПАТТЕРНА (index=0)"}),F=ie({tooltip:"Материал БОКОВОЙ КАРТИНКИ (index=1)"}),L=ie({tooltip:"u-поле цвета #1 (только mat0)"}),q=ie({tooltip:"u-поле цвета #2 (только mat0)"}),E=ie({tooltip:"u-поле ТЕКСТУРЫ ПАТТЕРНА (для mat0)"}),B=ie({tooltip:"u-поле БОКОВОЙ ТЕКСТУРЫ (для mat1)"}),D=ie({tooltip:"Расширение по умолчанию для URL"}),O=ie({type:h,tooltip:"Глобальная ТЕКСТУРА ПРИ ЗАГРУЗКЕ (для mat1)"}),j=ie({type:h,tooltip:"Глобальная ТЕКСТУРА ОШИБКИ (для mat1)"}),A(((re=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,r(t,"themes",W,i(t)),r(t,"patternTextures",J,i(t)),r(t,"patternMatIndex",K,i(t)),r(t,"sideMatIndex",$,i(t)),r(t,"color1Uniform",Q,i(t)),r(t,"color2Uniform",V,i(t)),r(t,"textureUniform",X,i(t)),r(t,"sideTextureUniform",Y,i(t)),r(t,"defaultExt",Z,i(t)),r(t,"loadingSideTexture",ee,i(t)),r(t,"errorSideTexture",te,i(t)),t._urlEntry=new Map,t._applied=new WeakMap,t._lastReqToken=new WeakMap,t}n(t,e);var s=t.prototype;return s.onLoad=function(){if(t._i)this.destroy();else{t._i=this,d.addPersistRootNode(this.node);try{var e=document.createElement("canvas");e.width=1,e.height=1,e.getContext("2d").clearRect(0,0,1,1);var r=new f(e),n=new h;n.image=r;for(var i,o=a(this.themes);!(i=o()).done;){var l=i.value;l.sideTexture||(l.sideTexture=n)}this.loadingSideTexture||(this.loadingSideTexture=n),this.errorSideTexture||(this.errorSideTexture=n)}catch(e){}}},s.getThemeByName=function(e){var t;if(!e)return null;var r=e.trim().toLowerCase();return r&&null!=(t=this.themes.find((function(e){var t;return(null!=(t=null==e?void 0:e.name)?t:"").trim().toLowerCase()===r})))?t:null},s.pickRandomTheme=function(e,t){var r;if(!this.themes.length)return null;var n,i=(e^2654435769*t)>>>0,a=Math.floor((n=i+=1831565813,n=Math.imul(n^n>>>15,1|n),(((n^=n+Math.imul(n^n>>>7,61|n))^n>>>14)>>>0)/4294967296*this.themes.length));return null!=(r=this.themes[a])?r:this.themes[0]},s.resolveTheme=function(e,t,r){var n;return null!=(n=this.getThemeByName(e))?n:this.pickRandomTheme(t,r)},s.applyThemeForPiece=function(e,t,r,n,i){var a=e instanceof m?e:e.getComponent(m);if(a&&t){var o=a.getMaterialInstance(this.patternMatIndex);if(o){try{o.setProperty(this.color1Uniform,t.color1),o.setProperty(this.color2Uniform,t.color2)}catch(e){}var l=this.resolvePatternTexture(n,r,i);if(l)try{o.setProperty(this.textureUniform,l),this._swapAppliedRecord(a,this.patternMatIndex,this.textureUniform,null)}catch(e){}else this._applyNull(a,this.patternMatIndex,this.textureUniform)}var u=a.getMaterialInstance(this.sideMatIndex);if(u)if(t.sideTexture)try{u.setProperty(this.sideTextureUniform,t.sideTexture),this._swapAppliedRecord(a,this.sideMatIndex,this.sideTextureUniform,null)}catch(e){}else this._applyNull(a,this.sideMatIndex,this.sideTextureUniform)}},s.resolvePatternTexture=function(e,t,r){var n=this.patternTextures;if(null==n||!n.length)return null;if(null!=r){var i,a=n.length;if(a>0)return null!=(i=n[(r%a+a)%a])?i:null}return this.pickPatternTexture(e,t)},s.pickPatternTexture=function(e,t){var r,n=this.patternTextures;if(null==n||!n.length)return null;var i=(e^2246822519*t)>>>0;return null!=(r=n[((i+=1831565813)>>>0)%n.length])?r:null},s.applyMainTextureFromUrlOrThemeSide=function(){var e=l(u().mark((function e(t,r,n){var i,a,o,l,s,p,c,h,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t instanceof m?t:t.getComponent(m)){e.next=3;break}return e.abrupt("return","skipped");case 3:if(l=o.getMaterialInstance(this.sideMatIndex)){e.next=6;break}return e.abrupt("return","skipped");case 6:if(s=null!=(i=null==n?void 0:n.sideTexture)?i:null,r&&""!==r.trim()){e.next=21;break}if(!s){e.next=19;break}return e.prev=9,l.setProperty(this.sideTextureUniform,s),this._swapAppliedRecord(o,this.sideMatIndex,this.sideTextureUniform,null),e.abrupt("return","theme");case 15:return e.prev=15,e.t0=e.catch(9),this._applyNull(o,this.sideMatIndex,this.sideTextureUniform),e.abrupt("return","cleared");case 19:return this._applyNull(o,this.sideMatIndex,this.sideTextureUniform),e.abrupt("return","cleared");case 21:try{(h=null!=(p=null!=(c=this.loadingSideTexture)?c:s)?p:null)&&(l.setProperty(this.sideTextureUniform,h),this._swapAppliedRecord(o,this.sideMatIndex,this.sideTextureUniform,null))}catch(e){}return d=(null!=(a=this._lastReqToken.get(o))?a:0)+1,this._lastReqToken.set(o,d),e.next=26,this._acquire(r,this.defaultExt);case 26:if(f=e.sent,this._lastReqToken.get(o)===d){e.next=30;break}return f&&this._release(r),e.abrupt("return","skipped");case 30:if(!f){e.next=42;break}return e.prev=31,e.next=34,new Promise((function(e){"undefined"!=typeof requestAnimationFrame?requestAnimationFrame((function(){return e()})):setTimeout(e,0)}));case 34:return l.setProperty(this.sideTextureUniform,f),this._swapAppliedRecord(o,this.sideMatIndex,this.sideTextureUniform,r),e.abrupt("return","applied");case 39:e.prev=39,e.t1=e.catch(31),this._release(r);case 42:if(e.prev=42,!this.errorSideTexture){e.next=47;break}return l.setProperty(this.sideTextureUniform,this.errorSideTexture),this._swapAppliedRecord(o,this.sideMatIndex,this.sideTextureUniform,null),e.abrupt("return","error");case 47:e.next=51;break;case 49:e.prev=49,e.t2=e.catch(42);case 51:if(!s){e.next=60;break}return e.prev=52,l.setProperty(this.sideTextureUniform,s),this._swapAppliedRecord(o,this.sideMatIndex,this.sideTextureUniform,null),e.abrupt("return","theme");case 58:e.prev=58,e.t3=e.catch(52);case 60:return this._applyNull(o,this.sideMatIndex,this.sideTextureUniform),e.abrupt("return","cleared");case 62:case"end":return e.stop()}}),e,this,[[9,15],[31,39],[42,49],[52,58]])})));return function(t,r,n){return e.apply(this,arguments)}}(),s._applyNull=function(e,t,r){var n=e.getMaterialInstance(t);if(n)try{n.setProperty(r,null)}catch(e){}},s._key=function(e,t){return e+"|"+t},s._getAppliedMap=function(e){var t=this._applied.get(e);return t||(t=new Map,this._applied.set(e,t)),t},s._swapAppliedRecord=function(e,t,r,n){var i,a,o=this._getAppliedMap(e),l=this._key(t,r),u=null!=(i=null==(a=o.get(l))?void 0:a.url)?i:null;u&&u!==n&&this._release(u),o.set(l,{url:n})},s._acquire=function(){var e=l(u().mark((function e(t,r){var n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this._urlEntry.get(t))||(n={refs:0},this._urlEntry.set(t,n)),!n.tex){e.next=5;break}return n.refs++,e.abrupt("return",n.tex);case 5:return n.loading||(n.loading=l(u().mark((function e(){var n,i,a,o,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{cache:"force-cache"});case 3:if((n=e.sent).ok){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,n.blob();case 8:return i=e.sent,e.next=11,createImageBitmap(i,{premultiplyAlpha:"premultiply",colorSpaceConversion:"none"});case 11:return a=e.sent,o=new f(a),(l=new h).image=o,e.abrupt("return",l);case 18:return e.prev=18,e.t0=e.catch(0),e.next=22,new Promise((function(e){var n=/\.(png|jpg|jpeg|webp|bmp|gif)(\?|#|$)/i.test(t)?void 0:{ext:r};b.loadRemote(t,n,(function(t,r){if(!t&&r){var n=new h;n.image=r,e(n)}else e(null)}))}));case 22:return e.abrupt("return",e.sent);case 23:case"end":return e.stop()}}),e,null,[[0,18]])})))().then((function(e){return n.loading=void 0,e&&(n.tex=e),e}))),e.next=8,n.loading;case 8:return(i=e.sent)&&n.refs++,e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),s._release=function(e){var t=this._urlEntry.get(e);if(t&&(t.refs=Math.max(0,t.refs-1),0===t.refs&&t.tex)){try{t.tex.destroy()}catch(e){}t.tex=void 0,this._urlEntry.delete(e)}},s._applyTextColorFromThemeSafely=function(e,t){var r=null==e?void 0:e.arcText;if(r&&null!=t&&t.textColor){var n=r.enabled;n||(r.enabled=!0);try{null==r.rebuildNow||r.rebuildNow()}catch(e){}this.scheduleOnce((function(){try{r.setColor(t.textColor)}catch(e){}!n&&r.freezeAfterBuild&&(r.enabled=!1)}),0)}},s.applyThemeToBinding=function(e,t,r,n,i,a){var o,l,u,s,p,c;if(!e)return"no-binding";var h=this.resolveTheme(t,null!=a?a:n,r);if(!h)return"no-theme";var d=null!=(o=null!=(l=null!=(u=null!=(s=null==e.getPreferredMeshRenderer?void 0:e.getPreferredMeshRenderer())?s:e.meshRenderer)?u:null==(p=e.model)?void 0:p.getComponent(m))?l:null==(c=e.node)?void 0:c.getComponent(m))?o:null;return d&&this.applyThemeForPiece(d,h,r,n,i),this._applyTextColorFromThemeSafely(e,h),"ok"},s.applyApiTextToBinding=function(e,t){var r,n,i;if(!e)return"no-binding";var a=null!=(r=t.title)?r:"",o=null!=(n=t.name)?n:"";return null==(i=e.arcText)||i.applyApiData({title:a,name:o}),"ok"},s.applySideUrlOrThemeToBinding=function(){var e=l(u().mark((function e(t,r,n,i,a){var o,l,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return","no-binding");case 2:if(l=null!=(o=null==t.getPreferredMeshRenderer?void 0:t.getPreferredMeshRenderer())?o:null){e.next=5;break}return e.abrupt("return","skipped");case 5:return s=this.resolveTheme(n,a,i),e.next=8,this.applyMainTextureFromUrlOrThemeSide(l,r,null!=s?s:void 0);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}(),o(t,null,[{key:"instance",get:function(){return this._i}}]),t}(x))._i=null,W=t((H=re).prototype,"themes",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),J=t(H.prototype,"patternTextures",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),K=t(H.prototype,"patternMatIndex",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$=t(H.prototype,"sideMatIndex",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Q=t(H.prototype,"color1Uniform",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"uColor1"}}),V=t(H.prototype,"color2Uniform",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"uColor2"}}),X=t(H.prototype,"textureUniform",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"TextureUniform"}}),Y=t(H.prototype,"sideTextureUniform",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"uSideTex"}}),Z=t(H.prototype,"defaultExt",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return".png"}}),ee=t(H.prototype,"loadingSideTexture",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=t(H.prototype,"errorSideTexture",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=H))||G));s._RF.pop()}}}));

System.register("chunks:///_virtual/DebugPanelToggle.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,o,s,i,r,u,l;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,o=e._decorator,s=e.setDisplayStats,i=e.systemEvent,r=e.SystemEvent,u=e.KeyCode,l=e.Component}],execute:function(){var a;n._RF.push({},"cfda1+1JjNMa47nVqaXXSGs","DebugPanelToggle",void 0);var c=o.ccclass;e("DebugPanelToggle3x",c("DebugPanelToggle3x")(a=function(e){function n(){for(var t,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(t=e.call.apply(e,[this].concat(o))||this)._debugVisible=!1,t}t(n,e);var o=n.prototype;return o.start=function(){s(!1),i.on(r.EventType.KEY_DOWN,this.onKeyDown,this)},o.onKeyDown=function(e){e.keyCode===u.KEY_P&&(this._debugVisible=!this._debugVisible,s(this._debugVisible))},o.onDestroy=function(){i.off(r.EventType.KEY_DOWN,this.onKeyDown,this)},n}(l))||a);n._RF.pop()}}}));

System.register("chunks:///_virtual/GlobalClickManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ClickMoveBinding.ts","./InteractionState.ts","./PointerIds.ts","./RotateYByKeys.ts","./TVS_SpawnLayout.ts","./TowerScrollController.ts","./ColorLibrary.ts"],(function(e){var t,i,n,r,o,l,a,s,u,c,d,p,h,b,f,m,g,y,v,O,w,M,E,C,S,T,D,I;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,n=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.createClass,l=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,u=e._decorator,c=e.Camera,d=e.Node,p=e.input,h=e.Input,b=e.geometry,f=e.PhysicsSystem,m=e.Vec3,g=e.tween,y=e.MeshRenderer,v=e.Component,O=e.sys,w=e.ParticleSystem},function(e){M=e.ClickMoveBinding},function(e){E=e.InteractionState},function(e){C=e.MOUSE_ID},function(e){S=e.RotateYByKeys},function(e){T=e.TowerLayoutController},function(e){D=e.TowerScrollController},function(e){I=e.ColorTextureLibrary}],execute:function(){var x,R,L,P,A,B,z,k,Y,_,U,F,N,G,W,Z,H,q,j,X,V,K,J,Q,$,ee,te,ie,ne,re,oe,le,ae,se,ue,ce,de,pe,he,be,fe,me,ge,ye,ve,Oe,we,Me,Ee,Ce,Se,Te,De,Ie,xe,Re,Le,Pe,Ae,Be,ze,ke,Ye,_e,Ue,Fe,Ne,Ge,We,Ze,He,qe,je,Xe,Ve,Ke,Je,Qe,$e,et,tt,it,nt,rt,ot,lt,at,st,ut,ct,dt,pt,ht,bt,ft,mt,gt,yt,vt,Ot,wt,Mt,Et,Ct,St,Tt,Dt,It,xt,Rt,Lt,Pt,At,Bt,zt;s._RF.push({},"4bd86blOoRLpq75wEwnh3v5","GlobalClickManager",void 0);var kt=u.ccclass,Yt=u.property;function _t(e){var t=(e+180)%360;return t<0&&(t+=360),t-180}var Ut=function(e){return e.Idle="Idle",e.Aligning="Aligning",e.SlideOut="SlideOut",e.LockedOut="LockedOut",e.SlideIn="SlideIn",e}(Ut||{});e("GlobalClickManager3D",(x=kt("GlobalClickManager3D"),R=Yt({type:c,tooltip:"Камера для ПК/десктоп",group:{name:"REFS",id:"refs"},displayOrder:1}),L=Yt({type:c,tooltip:"Камера для мобильных",group:{name:"REFS",id:"refs"},displayOrder:2}),P=Yt({type:d,group:{name:"REFS",id:"refs"},displayOrder:3}),A=Yt({type:S,group:{name:"REFS",id:"refs"},displayOrder:4}),B=Yt({type:T,group:{name:"REFS",id:"refs"},displayOrder:5}),z=Yt({type:D,group:{name:"REFS",id:"refs"},displayOrder:6}),k=Yt({type:d,tooltip:"Блюр-подложка",group:{name:"REFS",id:"refs"},displayOrder:7}),Y=Yt({tooltip:"Целевой скейл на ПК (ось X/Y/Z одинаковые)",group:{name:"BLOOR / OVERLAY",id:"bloor"},displayOrder:1}),_=Yt({tooltip:"Целевой скейл на мобильных (обычно 1.0)",group:{name:"BLOOR / OVERLAY",id:"bloor"},displayOrder:2}),U=Yt({tooltip:"Длительность анимации показа bloor",group:{name:"BLOOR / OVERLAY",id:"bloor"},displayOrder:3}),F=Yt({tooltip:"Длительность анимации скрытия bloor",group:{name:"BLOOR / OVERLAY",id:"bloor"},displayOrder:4}),N=Yt({tooltip:"Easing анимации скейла bloor",group:{name:"BLOOR / OVERLAY",id:"bloor"},displayOrder:5}),G=Yt({type:d,tooltip:"Объект, который включаем после скейла bloor",group:{name:"BLOOR / OVERLAY",id:"bloor"},displayOrder:6}),W=Yt({tooltip:"Длительность смещения к центру по высоте",group:{name:"TIMINGS",id:"timings"},displayOrder:1}),Z=Yt({tooltip:"Длительность маленького подталкивания",group:{name:"TIMINGS",id:"timings"},displayOrder:2}),H=Yt({tooltip:"Длительность поворота корня по слоту",group:{name:"TIMINGS",id:"timings"},displayOrder:3}),q=Yt({tooltip:"Смещение центра по высоте для уровней 0..1 (ПК)",group:{name:"BIAS: DESKTOP",id:"bias_pc"},displayOrder:1}),j=Yt({tooltip:"Смещение центра по высоте для уровней ≥2 (ПК)",group:{name:"BIAS: DESKTOP",id:"bias_pc"},displayOrder:2}),X=Yt({tooltip:"Смещение центра по высоте для уровней 0..1 (Мобилка)",group:{name:"BIAS: MOBILE",id:"bias_mob"},displayOrder:1}),V=Yt({tooltip:"Смещение центра по высоте для уровней ≥2 (Мобилка)",group:{name:"BIAS: MOBILE",id:"bias_mob"},displayOrder:2}),K=Yt({tooltip:"Мировое расстояние выезда по X (ПК)",group:{name:"SLIDE",id:"slide"},displayOrder:1}),J=Yt({tooltip:"Мировое расстояние выезда по X (Мобилка)",group:{name:"SLIDE",id:"slide"},displayOrder:2}),Q=Yt({tooltip:"Доп. смещение по Y (мир) для ПК",group:{name:"SLIDE",id:"slide"},displayOrder:3}),$=Yt({tooltip:"Доп. смещение по Y (мир) для мобилки",group:{name:"SLIDE",id:"slide"},displayOrder:4}),ee=Yt({tooltip:"Доп. смещение по Z (мир) для ПК",group:{name:"SLIDE",id:"slide"},displayOrder:5}),te=Yt({tooltip:"Доп. смещение по Z (мир) для мобилки",group:{name:"SLIDE",id:"slide"},displayOrder:6}),ie=Yt({tooltip:"Easing для выезда/заезда",group:{name:"SLIDE",id:"slide"},displayOrder:7}),ne=Yt({tooltip:"Длительность выезда/заезда",group:{name:"SLIDE",id:"slide"},displayOrder:8}),re=Yt({tooltip:"Локальный угол «лицом» (0=+Z, 90=+X)",group:{name:"ROOT ROTATION",id:"rootrot"},displayOrder:1}),oe=Yt({tooltip:"+180° инверт оси модели",group:{name:"ROOT ROTATION",id:"rootrot"},displayOrder:2}),le=Yt({tooltip:"Фазовый сдвиг слота",group:{name:"ROOT ROTATION",id:"rootrot"},displayOrder:3}),ae=Yt({tooltip:"Длительность возврата модели к базе",group:{name:"MODEL CLOSE",id:"mclose"},displayOrder:1}),se=Yt({tooltip:"Easing возврата модели",group:{name:"MODEL CLOSE",id:"mclose"},displayOrder:2}),ue=Yt({tooltip:"Origin родителя для postMessage; пусто = *",group:{name:"INTEGRATION",id:"events"},displayOrder:1}),ce=Yt({tooltip:"Грузить картинку при клике на кусок",group:{name:"IMAGE LOADER",id:"img"},displayOrder:1}),de=Yt({tooltip:"Индекс материала для MainTexture",group:{name:"IMAGE LOADER",id:"img"},displayOrder:2}),pe=Yt({tooltip:"Имя юниформа текстуры в шейдере",group:{name:"IMAGE LOADER",id:"img"},displayOrder:3}),he=Yt({tooltip:"Подсказка расширения, если URL без него",group:{name:"IMAGE LOADER",id:"img"},displayOrder:4}),be=Yt({tooltip:"Очищать MainTexture при закрытии",group:{name:"IMAGE LOADER",id:"img"},displayOrder:5}),fe=Yt({tooltip:"Длительность полного оборота (360°)",group:{name:"OPEN SPIN",id:"ospin"},displayOrder:1}),me=Yt({tooltip:"Доп. доворот после 360° (deg)",group:{name:"OPEN SPIN",id:"ospin"},displayOrder:2}),ge=Yt({tooltip:"Длительность доп. доворота",group:{name:"OPEN SPIN",id:"ospin"},displayOrder:3}),ye=Yt({tooltip:"Easing для 360°+extra",group:{name:"OPEN SPIN",id:"ospin"},displayOrder:4}),ve=Yt({tooltip:"Включать idle-анимацию после открытия",group:{name:"IDLE",id:"idle"},displayOrder:1}),Oe=Yt({tooltip:"Амплитуда idle по X (градусы)",group:{name:"IDLE",id:"idle"},displayOrder:2}),we=Yt({tooltip:"Амплитуда idle по Y (градусы)",group:{name:"IDLE",id:"idle"},displayOrder:3}),Me=Yt({tooltip:"Амплитуда idle по Z (градусы)",group:{name:"IDLE",id:"idle"},displayOrder:4}),Ee=Yt({tooltip:"Длительность одного полного idle-цикла (сек)",group:{name:"IDLE",id:"idle"},displayOrder:5}),Ce=Yt({tooltip:"Включить доп.пинг-понг по Y (поверх синуса)",group:{name:"IDLE",id:"idle"},displayOrder:6}),Se=Yt({tooltip:"Минимальный относительный угол по Y (deg) для пинг-понга",group:{name:"IDLE",id:"idle"},displayOrder:7}),Te=Yt({tooltip:"Максимальный относительный угол по Y (deg) для пинг-понга",group:{name:"IDLE",id:"idle"},displayOrder:8}),De=Yt({tooltip:"Фазовый сдвиг синуса по Y (рад)",group:{name:"IDLE",id:"idle"},displayOrder:9}),Ie=Yt({tooltip:"Длительность плавного входа в idle (сек)",group:{name:"IDLE",id:"idle"},displayOrder:10}),xe=Yt({tooltip:"Кривизна easing при входе (0..1)",group:{name:"IDLE",id:"idle"},displayOrder:11}),Re=Yt({tooltip:"Скорость именно пинг-понга по Y (множитель)",group:{name:"IDLE",id:"idle"},displayOrder:12}),Le=Yt({tooltip:"Idle: стартовать к дальнему углу (а не к ближайшему)",group:{name:"IDLE",id:"idle"},displayOrder:13}),x((Be=t((Ae=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return t=e.call.apply(e,[this].concat(o))||this,n(t,"sceneCamera",Be,r(t)),n(t,"sceneCameraMobile",ze,r(t)),n(t,"rotatingRoot",ke,r(t)),n(t,"rotator",Ye,r(t)),n(t,"layoutCtrl",_e,r(t)),n(t,"scrollCtrl",Ue,r(t)),n(t,"bloor",Fe,r(t)),n(t,"bloorScaleDesktop",Ne,r(t)),n(t,"bloorScaleMobile",Ge,r(t)),n(t,"bloorScaleDuration",We,r(t)),n(t,"bloorHideDuration",Ze,r(t)),n(t,"bloorScaleEasing",He,r(t)),n(t,"afterBloorObject",qe,r(t)),n(t,"heightCenterDuration",je,r(t)),n(t,"heightNudgeDuration",Xe,r(t)),n(t,"rotateDuration",Ve,r(t)),n(t,"levelBiasTop",Ke,r(t)),n(t,"levelBiasRest",Je,r(t)),n(t,"levelBiasTopMobile",Qe,r(t)),n(t,"levelBiasRestMobile",$e,r(t)),n(t,"openWorldDistance",et,r(t)),n(t,"openWorldDistanceMobile",tt,r(t)),n(t,"openWorldOffsetYDesktop",it,r(t)),n(t,"openWorldOffsetYMobile",nt,r(t)),n(t,"openWorldOffsetZDesktop",rt,r(t)),n(t,"openWorldOffsetZMobile",ot,r(t)),n(t,"slideEasing",lt,r(t)),n(t,"slideDuration",at,r(t)),n(t,"faceYawLocalDeg",st,r(t)),n(t,"invertPieceAxis",ut,r(t)),n(t,"slotPhaseShift",ct,r(t)),n(t,"modelRotateDuration",dt,r(t)),n(t,"modelRotateEasing",pt,r(t)),n(t,"parentOrigin",ht,r(t)),n(t,"loadImageOnClick",bt,r(t)),n(t,"imageMatIndex",ft,r(t)),n(t,"imageUniform",mt,r(t)),n(t,"imageFallbackExt",gt,r(t)),n(t,"clearImageOnClose",yt,r(t)),n(t,"modelSpin360Duration",vt,r(t)),n(t,"modelExtraYawDeg",Ot,r(t)),n(t,"modelExtraYawDuration",wt,r(t)),n(t,"modelSpinEasing",Mt,r(t)),n(t,"enableIdleAnimation",Et,r(t)),n(t,"idleAmpX",Ct,r(t)),n(t,"idleAmpY",St,r(t)),n(t,"idleAmpZ",Tt,r(t)),n(t,"idleCycleSeconds",Dt,r(t)),n(t,"idleYRangeEnabled",It,r(t)),n(t,"idleYRangeMinDeg",xt,r(t)),n(t,"idleYRangeMaxDeg",Rt,r(t)),n(t,"idlePhaseY",Lt,r(t)),n(t,"idleBlendInSeconds",Pt,r(t)),n(t,"idleBlendCurve",At,r(t)),n(t,"idleYRangeSpeed",Bt,r(t)),n(t,"idleStartFar",zt,r(t)),t.fsm=Ut.Idle,t.clickedLevel=0,t.clickedSlot=0,t.currentPiece=null,t.currentBinding=null,t.baseLocalX=new Map,t.baseLocalPos=new Map,t.modelBaseEuler=new Map,t.rotateTween=null,t.modelTween=null,t.idleTween=null,t._emitOnThisAction=!1,t._activeCamera=null,t.bloorTween=null,t._idleAmpMulStart=0,t}i(t,e);var s=t.prototype;return s.updateActiveCamera=function(){var e,t,i,n,r=this.isMobile?null!=(e=this.sceneCameraMobile)?e:this.sceneCamera:null!=(t=this.sceneCamera)?t:this.sceneCameraMobile;this._activeCamera=null!=r?r:null,null!=(i=this.sceneCamera)&&i.node&&(this.sceneCamera.node.active=this._activeCamera===this.sceneCamera),null!=(n=this.sceneCameraMobile)&&n.node&&(this.sceneCameraMobile.node.active=this._activeCamera===this.sceneCameraMobile)},s.onEnable=function(){this.updateActiveCamera(),p.on(h.EventType.TOUCH_END,this.onTouchEnd,this),p.on(h.EventType.TOUCH_CANCEL,this.onTouchCancel,this),p.on(h.EventType.MOUSE_UP,this.onMouseUp,this);try{null==window.addEventListener||window.addEventListener("resize",this.updateActiveCamera.bind(this))}catch(e){}},s.onDisable=function(){p.off(h.EventType.TOUCH_END,this.onTouchEnd,this),p.off(h.EventType.TOUCH_CANCEL,this.onTouchCancel,this),p.off(h.EventType.MOUSE_UP,this.onMouseUp,this);try{null==window.removeEventListener||window.removeEventListener("resize",this.updateActiveCamera.bind(this))}catch(e){}},s.onTouchEnd=function(e){if(this.activeCamera){if(this.fsm===Ut.LockedOut)return this._emitOnThisAction=!0,void this.closeAndInsert(!0);if(!E.inGesture||"mouse"!==E.source){var t=E.tryEndGesture(e.getID(),"touch"),i=t.ended,n=t.wasDragged;if(i&&!n){var r=e.getLocation();this.onClick(r.x,r.y)}}}},s.onTouchCancel=function(e){E.tryEndGesture(e.getID(),"touch")},s.onMouseUp=function(e){if(!this.isMobile&&this.activeCamera&&0===e.getButton()){if(this.fsm===Ut.LockedOut)return this._emitOnThisAction=!0,void this.closeAndInsert(!0);if(!E.inGesture||"touch"!==E.source)if(!E.tryEndGesture(C,"mouse").wasDragged&&!E.consumeRecentDrag()){var t=e.getLocation();this.onClick(t.x,t.y)}}},s.onClick=function(){var e=l(a().mark((function e(t,i){var n,r,o,l,s,u,c,d,p,h,b,f,m,g;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.activeCamera&&this.rotatingRoot&&this.layoutCtrl&&this.scrollCtrl){e.next=2;break}return e.abrupt("return");case 2:if(this.fsm===Ut.Idle){e.next=4;break}return e.abrupt("return");case 4:if(o=this.raycastToBindingNode(t,i)){e.next=7;break}return e.abrupt("return");case 7:if(this.safePostToParent("OPEN_WORLD_PIECE"),l=null!=(n=o.binding.model)?n:o.n,s=this.layoutCtrl.getLevelForAny(l),u=this.layoutCtrl.getSlotForAny(l),null!=s&&null!=u){e.next=13;break}return e.abrupt("return");case 13:return this.clickedLevel=s,this.clickedSlot=u,this._emitOnThisAction=!0,this.postPieceEvent("OPENING",s,u),this.lockControls(),this.fsm=Ut.Aligning,c=this.isMobile?this.levelBiasTopMobile:this.levelBiasTop,d=this.isMobile?this.levelBiasRestMobile:this.levelBiasRest,p=s<=1?c:d,h=this.layoutCtrl.getLevelStep(),b=(s+p)*h,this.isMobile?this.layoutCtrl.ensureBottomPaddingForHeight(b,1):this.layoutCtrl.ensureBottomPaddingForHeight(b,0),e.next=27,this.centerToHeightUnclampedAsync(b);case 27:return e.next=29,this.rotateRootToBringSlotToCamera(this.clickedSlot);case 29:return f=this.layoutCtrl.findNodeByLevelSlot(this.clickedLevel,this.clickedSlot),m=null!=f?f:o.n,g=m.getComponent(M)||m.getComponentInChildren(M)||o.binding,this.currentPiece=m,this.currentBinding=g,this.applyImageToCurrentPiece(this.clickedLevel,this.clickedSlot),e.next=37,this.slideOutWithScaleComp();case 37:return this.setRimActive(!0),this.showBloor(),e.next=41,this.rotateModelOpen();case 41:null==(r=this.currentBinding)||null==r.playSequence||r.playSequence(),this.postPieceEvent("OPENED",this.clickedLevel,this.clickedSlot),this._emitOnThisAction=!1,this.fsm=Ut.LockedOut;case 45:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}(),s.getBloorTargetScale=function(){return this.isMobile?this.bloorScaleMobile:this.bloorScaleDesktop},s.showBloor=function(){var e=l(a().mark((function e(){var t,i,n,r=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.bloor){e.next=3;break}return e.abrupt("return");case 3:return this.bloorTween&&(this.bloorTween.stop(),this.bloorTween=null),i=this.getBloorTargetScale(),t.active=!0,t.setScale(0,1,0),n={t:0},e.next=10,new Promise((function(e){r.bloorTween=g(n).to(r.bloorScaleDuration,{t:1},{easing:r.bloorScaleEasing,onUpdate:function(){var e=n.t*i;t.setScale(e,1,e)}}).call((function(){r.bloorTween=null,r.afterBloorObject&&(r.afterBloorObject.active=!0),e()})).start()}));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.hideBloor=function(){var e=l(a().mark((function e(){var t,i,n,r,o=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.bloor){e.next=3;break}return e.abrupt("return");case 3:return this.bloorTween&&(this.bloorTween.stop(),this.bloorTween=null),i=t.scale.x,n=t.scale.z,r={t:0},e.next=9,new Promise((function(e){var l;o.bloorTween=g(r).to(null!=(l=o.bloorHideDuration)?l:o.bloorScaleDuration,{t:1},{easing:o.bloorScaleEasing,onUpdate:function(){var e=(1-r.t)*i,o=(1-r.t)*n;t.setScale(e,1,o)}}).call((function(){o.bloorTween=null,t.active=!1,t.setScale(0,1,0),e()})).start()}));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.raycastToBindingNode=function(e,t){if(!this.activeCamera)return null;var i=new b.Ray;if(this.activeCamera.screenPointToRay(e,t,i),!f.instance.raycastClosest(i))return null;for(var n=f.instance.raycastClosestResult.collider.node,r=null;n&&!r;)(r=n.getComponent(M)||null)||(n=n.parent);return n&&r?{n:n,binding:r}:null},s.rotateRootToBringSlotToCamera=function(e){var t=this;return new Promise((function(i){var n;if(t.rotatingRoot&&t.activeCamera&&t.layoutCtrl){var r=t.rotatingRoot,o=r.worldPosition,l=t.activeCamera.node.worldPosition,a=new m(l.x-o.x,0,l.z-o.z);if(a.length()<1e-4)i();else{a.normalize();var s,u=(s=a,180*Math.atan2(s.x,s.z)/Math.PI),c=t.layoutCtrl.spawn.angleStep,d=Math.max(1,t.layoutCtrl.spawn.objectsPerLevel),p=u-(((e+t.slotPhaseShift)%d+d)%d*c+(t.faceYawLocalDeg+(t.invertPieceAxis?180:0))),h=r.eulerAngles,b=(h.y%360+360)%360,f=_t(p-b);if(Math.abs(f)<.05||t.rotateDuration<=0)return r.setRotationFromEuler(h.x,b+f,h.z),void i();null==(n=t.rotator)||n.stopInertia(),t.rotateTween&&(t.rotateTween.stop(),t.rotateTween=null);var y={t:0};t.rotateTween=g(y).to(t.rotateDuration,{t:1},{easing:"quadOut",onUpdate:function(){var e=b+f*y.t;r.setRotationFromEuler(h.x,e,h.z)}}).call((function(){t.rotateTween=null,i()})).start()}}else i()}))},s.slideOutWithScaleComp=function(){var e=l(a().mark((function e(){var t,i,n,r,o,l,s,u,c,d,p,h,b,f,g,y,v,O;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentPiece&&this.currentBinding){e.next=2;break}return e.abrupt("return");case 2:return n=null!=(t=this.currentBinding.target)?t:this.currentPiece,r=n.parent,o=null!=(i=null==r?void 0:r.worldScale)?i:new m(1,1,1),l=this.isMobile?this.openWorldDistanceMobile:this.openWorldDistance,s=this.isMobile?this.openWorldOffsetYMobile:this.openWorldOffsetYDesktop,u=this.isMobile?this.openWorldOffsetZMobile:this.openWorldOffsetZDesktop,c=l/Math.max(1e-6,o.x),d=s/Math.max(1e-6,o.y),p=u/Math.max(1e-6,o.z),this.baseLocalPos.has(n)||this.baseLocalPos.set(n,n.position.clone()),h=this.baseLocalPos.get(n).clone(),b=new m(h.x+c,h.y+d,h.z+p),e.next=16,this.tweenLocalPos(n,b,this.slideDuration,this.slideEasing);case 16:if(f=null,g=this.currentBinding.pullParticleObject){g.active=!0,f=g.getComponent(w);try{null==(y=f)||y.stop(),null==(v=f)||v.clear()}catch(e){}try{null==(O=f)||O.play()}catch(e){}}case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.setRimActive=function(e){var t,i=null==(t=this.currentBinding)?void 0:t.rim;i&&i.active!==e&&(i.active=e)},s.setRimActiveFor=function(e,t){var i=null==e?void 0:e.rim;i&&i.active!==t&&(i.active=t)},s.closeAndInsert=function(){var e=l(a().mark((function e(t){var i,n,r,o,l,s,u,c,d,p,h,b,f,m;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!1),this.fsm===Ut.LockedOut){e.next=3;break}return e.abrupt("return");case 3:if(this.fsm=Ut.SlideIn,this.hideBloor(),this.afterBloorObject&&(this.afterBloorObject.active=!1),o=null!=(i=null==(n=this.currentBinding)?void 0:n.pullParticleObject)?i:null){l=o.getComponent(w);try{null==l||l.stop()}catch(e){}o.active=!1}return s=this.clickedLevel,u=this.clickedSlot,this.stopIdleAnimation(),e.next=13,null==(r=this.currentBinding)||null==r.playSequenceCloseAndReset?void 0:r.playSequenceCloseAndReset();case 13:return e.next=15,this.rotateModelCloseToBaseEuler();case 15:if(this.setRimActive(!1),!this.currentPiece||!this.currentBinding){e.next=21;break}return p=null!=(c=this.currentBinding.target)?c:this.currentPiece,h=null!=(d=this.baseLocalPos.get(p))?d:p.position.clone(),e.next=21,this.tweenLocalPos(p,h.clone(),this.slideDuration,this.slideEasing);case 21:this.clearImageOnClose&&(b=I.instance)&&this.currentPiece&&this.currentBinding&&(m=null!=(f=this.currentBinding.model)?f:this.currentPiece,b.clearAppliedTexture(m,this.imageMatIndex,this.imageUniform)),this.unlockControls(),this.currentPiece=null,this.currentBinding=null,this.fsm=Ut.Idle,t&&this.postPieceEvent("CLOSED",s,u),this._emitOnThisAction=!1;case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.getUrlForPiece=function(e,t){var i=this.layoutCtrl;if(!i)return null;try{var n,r=i.levelSlotToDataIndex(e,t);if(r<0)return null;var o=i.getPieceByDataIndex(r);return null!=(n=null==o?void 0:o.file)?n:null}catch(e){return null}},s.tweenLocalX=function(e,t,i,n){return new Promise((function(r){var o=e.position.x;if(Math.abs(t-o)<1e-4||i<=0){var l=e.position.clone();return l.x=t,e.setPosition(l),void r()}var a=e.position.clone(),s={t:0};g(s).to(i,{t:1},{easing:n,onUpdate:function(){var i=e.position.clone();i.x=a.x+(t-a.x)*s.t,e.setPosition(i)}}).call((function(){return r()})).start()}))},s.tweenLocalPos=function(e,t,i,n){return new Promise((function(r){var o=e.position.clone();if(t.clone().subtract(o).length()<1e-4||i<=0)return e.setPosition(t),void r();var l={t:0};g(l).to(i,{t:1},{easing:n,onUpdate:function(){var i=new m(o.x+(t.x-o.x)*l.t,o.y+(t.y-o.y)*l.t,o.z+(t.z-o.z)*l.t);e.setPosition(i)}}).call((function(){return r()})).start()}))},s.rotateModelOpen=function(){var e=l(a().mark((function e(){var t,i,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentBinding){e.next=2;break}return e.abrupt("return");case 2:if(t=this.currentBinding.model){e.next=5;break}return e.abrupt("return");case 5:return this.modelBaseEuler.has(t)||this.modelBaseEuler.set(t,t.eulerAngles.clone()),i=360+this.modelExtraYawDeg,n=this.modelSpin360Duration+this.modelExtraYawDuration,e.next=10,this.rotateModelYawByUnwrapped(t,i,n,this.modelSpinEasing);case 10:this._idleAmpMulStart=0,this.startIdleAnimation(t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.rotateModelCloseToBaseEuler=function(){var e=l(a().mark((function e(){var t,i,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentBinding){e.next=2;break}return e.abrupt("return");case 2:if(i=this.currentBinding.model){e.next=5;break}return e.abrupt("return");case 5:return n=null!=(t=this.modelBaseEuler.get(i))?t:i.eulerAngles.clone(),e.next=8,this.rotateModelToEuler(i,n,this.modelRotateDuration,this.modelRotateEasing);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.rotateModelYawByUnwrapped=function(e,t,i,n){var r=this;return new Promise((function(o){var l=e.eulerAngles,a=l.y,s=a+t;if(Math.abs(t)<.05||i<=0)return e.setRotationFromEuler(l.x,s,l.z),void o();r.modelTween&&(r.modelTween.stop(),r.modelTween=null);var u={t:0};r.modelTween=g(u).to(i,{t:1},{easing:n,onUpdate:function(){var i=a+t*u.t;e.setRotationFromEuler(l.x,i,l.z)}}).call((function(){r.modelTween=null,o()})).start()}))},s.rotateModelToEuler=function(e,t,i,n){var r=this;return new Promise((function(o){var l=e.eulerAngles,a=(l.x%360+360)%360,s=(l.y%360+360)%360,u=(l.z%360+360)%360,c=(t.x%360+360)%360,d=(t.y%360+360)%360,p=(t.z%360+360)%360,h=_t(c-a),b=_t(d-s),f=_t(p-u);if(Math.abs(h)+Math.abs(b)+Math.abs(f)<.05||i<=0)return e.setRotationFromEuler(a+h,s+b,u+f),void o();r.modelTween&&(r.modelTween.stop(),r.modelTween=null);var m={t:0};r.modelTween=g(m).to(i,{t:1},{easing:n,onUpdate:function(){e.setRotationFromEuler(a+h*m.t,s+b*m.t,u+f*m.t)}}).call((function(){r.modelTween=null,o()})).start()}))},s.startIdleAnimation=function(e){var t,i,n=this;if(this.enableIdleAnimation){this.idleTween&&(this.idleTween.stop(),this.idleTween=null);var r=2*Math.PI,o=null!=(t=this.idlePhaseY)?t:Math.PI/3,l=e.eulerAngles.clone(),a=e.eulerAngles.clone(),s=function(e,t){var i=t,n=i-e,r=i+360-e,o=i-360-e,l=Math.abs(n),a=Math.abs(r),s=Math.abs(o);return a<l&&a<=s?i+=360:s<l&&s<a&&(i-=360),i},u=function(e){return.5*(1-Math.cos(e))},c=l.y+Math.min(this.idleYRangeMinDeg,this.idleYRangeMaxDeg),d=l.y+Math.max(this.idleYRangeMinDeg,this.idleYRangeMaxDeg),p=d-c,h=.5*(c+d),b=Math.round((a.y-h)/360);c+=360*b,d+=360*b;var f,m,y,v=(f=a.y,m=c,y=d,Math.min(Math.max(f,m),y)),O=p>1e-6?(v-c)/Math.max(1e-6,p):0,w=Math.acos(Math.max(-1,Math.min(1,1-2*O))),M=r-w,E=function(e){var t=e*n.idleYRangeSpeed,i=(n.idleYRangeEnabled?c+p*u(t):l.y)-l.y;return l.y+i+n.idleAmpY*Math.sin(e+o)},C=Math.abs(E(w)-a.y),S=Math.abs(E(M)-a.y),T={phase:this.idleStartFar?C>S?w:M:C<=S?w:M,t:0,ampMul:null!=(i=this._idleAmpMulStart)?i:0},D=a.x,I=a.y,x=a.z;e.setRotationFromEuler(D,I,x),this.idleTween=g(T).repeatForever(g(T).by(this.idleCycleSeconds,{phase:r,t:this.idleCycleSeconds},{easing:"linear",onUpdate:function(){var t=T.phase,i=n.idleBlendInSeconds>0?Math.min(1,T.t/n.idleBlendInSeconds):1;T.ampMul=function(e){var t=1-(1-e)*(1-e);if(n.idleBlendCurve>0){var i=n.idleBlendCurve;t=(1-i)*t+i*Math.pow(t,1.5)}return t}(i);var r=n.idleAmpX*Math.sin(t),a=n.idleAmpY*Math.sin(t+o),d=n.idleAmpZ*Math.sin(t+Math.PI/5),h=t*n.idleYRangeSpeed,b=(n.idleYRangeEnabled?c+p*u(h):l.y)-l.y,f=l.x+T.ampMul*r,m=l.y+T.ampMul*(b+a),g=l.z+T.ampMul*d;f=s(D,f),m=s(I,m),g=s(x,g),e.setRotationFromEuler(f,m,g),D=f,I=m,x=g}})).start()}},s.stopIdleAnimation=function(){this.idleTween&&(this.idleTween.stop(),this.idleTween=null)},s.lockControls=function(){var e;null==(e=this.rotator)||e.stopInertia(),this.rotator&&(this.rotator.enabled=!1),this.scrollCtrl&&(this.scrollCtrl.setInputEnabled(!1),this.scrollCtrl.stopAll()),null==E.hardReset||E.hardReset()},s.unlockControls=function(){this.rotator&&(this.rotator.enabled=!0),this.scrollCtrl&&this.scrollCtrl.setInputEnabled(!0),null==E.hardReset||E.hardReset()},s.safePostToParent=function(e){var t=this.parentOrigin&&this.parentOrigin.trim().length?this.parentOrigin:"*";try{var i;null==(i=window.parent)||i.postMessage(e,t)}catch(e){}},s.buildPiecePayload=function(e,t){var i=this.layoutCtrl;try{var n=i.levelSlotToDataIndex(e,t);return{level:e,slot:t,dataIndex:n,piece:n>=0?i.getPieceByDataIndex(n):null}}catch(i){return{level:e,slot:t}}},s.postPieceEvent=function(e,t,i){if(this._emitOnThisAction){var n=this.buildPiecePayload(t,i);console.log("[GM3D->parent]",e,n),this.safePostToParent({type:e,payload:n})}},s.applyImageToCurrentPiece=function(e,t){if(this.loadImageOnClick){var i=I.instance;if(i){var n,r,o,l,a,s,u,c=this.currentPiece,d=this.currentBinding;if(c&&d){var p=null!=(n=d.model)?n:c,h=this.getUrlForPiece(e,t);if(console.log("[GCM3D] url resolved for L="+e+" S="+t+":",h),null!=h){var b=p.getComponent(y)||p.getComponentInChildren(y);if(b){var f=null!=(r=null==(o=this.getPieceFor)?void 0:o.call(this,e,t))?r:null,m=this._makeStableGidx(e,t,null!=(l=null==f?void 0:f.uniq_id)?l:null),g=(null!=(a=null==(s=this.spawn)?void 0:s.rngSeedColors)?a:987654321)>>>0,v=i.resolveTheme(null!=(u=null==f?void 0:f.hex_color)?u:null,g,m);i.applyMainTextureFromUrlOrThemeSide(b,h,v).then((function(e){console.log("[GCM3D] texture apply status:",e)}))}else console.warn("[GCM3D] MeshRenderer not found")}}}else console.warn("[GCM3D] ColorTextureLibrary.instance не найден")}},s.centerToHeightUnclampedAsync=function(){var e=l(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.scrollCtrl){e.next=2;break}return e.abrupt("return");case 2:return this.scrollCtrl.pushUnclamped(!0),e.prev=3,e.next=6,this.scrollCtrl.scrollToHeightWithNudgeAsync(t,this.heightCenterDuration,this.heightNudgeDuration,"quadOut",!1);case 6:return e.prev=6,this.scrollCtrl.popUnclamped(),e.finish(6);case 9:case"end":return e.stop()}}),e,this,[[3,,6,9]])})));return function(t){return e.apply(this,arguments)}}(),s._makeStableGidx=function(e,t,i){return i&&"string"==typeof i?this._fnv1a32(i):((65535&e)<<16|65535&t)>>>0},s._fnv1a32=function(e){for(var t=2166136261,i=0;i<e.length;i++)t^=e.charCodeAt(i),t=Math.imul(t,16777619)>>>0;return t>>>0},o(t,[{key:"isMobile",get:function(){return O.isMobile}},{key:"activeCamera",get:function(){return this._activeCamera}}]),t}(v)).prototype,"sceneCamera",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ze=t(Ae.prototype,"sceneCameraMobile",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ke=t(Ae.prototype,"rotatingRoot",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ye=t(Ae.prototype,"rotator",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=t(Ae.prototype,"layoutCtrl",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ue=t(Ae.prototype,"scrollCtrl",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fe=t(Ae.prototype,"bloor",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ne=t(Ae.prototype,"bloorScaleDesktop",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.85}}),Ge=t(Ae.prototype,"bloorScaleMobile",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),We=t(Ae.prototype,"bloorScaleDuration",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Ze=t(Ae.prototype,"bloorHideDuration",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),He=t(Ae.prototype,"bloorScaleEasing",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"quadOut"}}),qe=t(Ae.prototype,"afterBloorObject",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je=t(Ae.prototype,"heightCenterDuration",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.35}}),Xe=t(Ae.prototype,"heightNudgeDuration",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Ve=t(Ae.prototype,"rotateDuration",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.35}}),Ke=t(Ae.prototype,"levelBiasTop",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-3}}),Je=t(Ae.prototype,"levelBiasRest",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-4}}),Qe=t(Ae.prototype,"levelBiasTopMobile",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-3}}),$e=t(Ae.prototype,"levelBiasRestMobile",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-4}}),et=t(Ae.prototype,"openWorldDistance",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.6}}),tt=t(Ae.prototype,"openWorldDistanceMobile",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.6}}),it=t(Ae.prototype,"openWorldOffsetYDesktop",[Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nt=t(Ae.prototype,"openWorldOffsetYMobile",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rt=t(Ae.prototype,"openWorldOffsetZDesktop",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ot=t(Ae.prototype,"openWorldOffsetZMobile",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lt=t(Ae.prototype,"slideEasing",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"quadOut"}}),at=t(Ae.prototype,"slideDuration",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.25}}),st=t(Ae.prototype,"faceYawLocalDeg",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ut=t(Ae.prototype,"invertPieceAxis",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ct=t(Ae.prototype,"slotPhaseShift",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dt=t(Ae.prototype,"modelRotateDuration",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.25}}),pt=t(Ae.prototype,"modelRotateEasing",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"quadOut"}}),ht=t(Ae.prototype,"parentOrigin",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),bt=t(Ae.prototype,"loadImageOnClick",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ft=t(Ae.prototype,"imageMatIndex",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mt=t(Ae.prototype,"imageUniform",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"MainTexture"}}),gt=t(Ae.prototype,"imageFallbackExt",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return".jpg"}}),yt=t(Ae.prototype,"clearImageOnClose",[be],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vt=t(Ae.prototype,"modelSpin360Duration",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.6}}),Ot=t(Ae.prototype,"modelExtraYawDeg",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),wt=t(Ae.prototype,"modelExtraYawDuration",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.25}}),Mt=t(Ae.prototype,"modelSpinEasing",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"quadOut"}}),Et=t(Ae.prototype,"enableIdleAnimation",[ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ct=t(Ae.prototype,"idleAmpX",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),St=t(Ae.prototype,"idleAmpY",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Tt=t(Ae.prototype,"idleAmpZ",[Me],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Dt=t(Ae.prototype,"idleCycleSeconds",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),It=t(Ae.prototype,"idleYRangeEnabled",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xt=t(Ae.prototype,"idleYRangeMinDeg",[Se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),Rt=t(Ae.prototype,"idleYRangeMaxDeg",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Lt=t(Ae.prototype,"idlePhaseY",[De],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Math.PI/3}}),Pt=t(Ae.prototype,"idleBlendInSeconds",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.4}}),At=t(Ae.prototype,"idleBlendCurve",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bt=t(Ae.prototype,"idleYRangeSpeed",[Re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),zt=t(Ae.prototype,"idleStartFar",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Pe=Ae))||Pe));s._RF.pop()}}}));

System.register("chunks:///_virtual/InteractionState.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"85bc8piAeJIyrMBDWo80N4k","InteractionState",void 0);var s=t("InteractionState",function(){function t(){}return t.peekRecentDrag=function(e){return void 0===e&&(e=t.DRAG_LATCH_MS),!!this.lastEndWasDragged&&Date.now()-this.lastEndAtMs<=e},t.consumeRecentDrag=function(e){void 0===e&&(e=t.DRAG_LATCH_MS);var s=this.peekRecentDrag(e);return s&&(this.lastEndWasDragged=!1,this.lastEndAtMs=0),s},t.beginGesture=function(t,e){this.inGesture||(this.inGesture=!0,this.ended=!1,this.activeId=t,this.source=e,this.draggedInGesture=!1,this.isRotating=!1,this.lastEndWasDragged=!1,this.lastEndAtMs=0)},t.markDrag=function(t){this.inGesture&&!this.ended&&this.activeId===t&&(this.draggedInGesture=!0,this.isRotating=!0)},t.tryEndGesture=function(t,e){if(!this.inGesture)return{ended:!0,wasDragged:this.peekRecentDrag()};if(this.activeId===t&&this.source===e){var s=this.draggedInGesture;return this._finalizeWithLatch(s),{ended:!0,wasDragged:s}}if(this.source===e||this.activeId===t){var i=this.draggedInGesture;return this._finalizeWithLatch(i),{ended:!0,wasDragged:i}}return{ended:!1,wasDragged:!1}},t.hardReset=function(){this.inGesture=!1,this.activeId=null,this.source=null,this.draggedInGesture=!1,this.isRotating=!1,this.ended=!0,this.lastEndWasDragged=!1,this.lastEndAtMs=0},t._finalizeWithLatch=function(t){this.inGesture=!1,this.ended=!0,this.activeId=null,this.source=null,this.draggedInGesture=!1,this.isRotating=!1,this.lastEndWasDragged=!!t,this.lastEndAtMs=Date.now()},t}());s.inGesture=!1,s.activeId=null,s.source=null,s.draggedInGesture=!1,s.isRotating=!1,s.ended=!0,s.lastEndWasDragged=!1,s.lastEndAtMs=0,s.DRAG_LATCH_MS=160,e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./ArcTextMesh.ts","./AddCake.ts","./AutoScaleCameraPosition.ts","./CakeApiExample.ts","./CameraTuner.ts","./ClickMoveBinding.ts","./ColorLibrary.ts","./GlobalClickManager.ts","./InteractionState.ts","./PingPongUpDown.ts","./PlatformCameraSwitcher.ts","./PointerIds.ts","./RotateYByKeys.ts","./StartApp.ts","./TVS_SpawnLayout.ts","./TowerScrollController.ts","./ArcTextColorTest.ts","./DebugPanelToggle.ts","./PieceSpawner.ts","./RemoteTextureToMaterial.ts","./TowerQueriesTester.ts","./cake.types.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PieceSpawner.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ColorLibrary.ts","./ClickMoveBinding.ts"],(function(e){var t,r,o,i,n,a,l,c,p,s,u,b,f,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,o=e.initializerDefineProperty,i=e.assertThisInitialized,n=e.createForOfIteratorHelperLoose,a=e.createClass},function(e){l=e.cclegacy,c=e._decorator,p=e.Prefab,s=e.instantiate,u=e.Vec3,b=e.Component},function(e){f=e.ColorTextureLibrary},function(e){w=e.ClickMoveBinding}],execute:function(){var d,h,y,g,v,m,S,P,C,_,N,z,I,O,j,E,L,M,R,D,F,x,T,k,H,A,B;l._RF.push({},"7c11fA6KKdNXKI0ygDDYDbj","PieceSpawner",void 0);var K=c.ccclass,Y=c.property,V=c.executeInEditMode,X=c.menu;e("PieceSpawner",(d=K("PieceSpawner"),h=V(),y=X("Custom/Piece Spawner"),g=Y({type:p}),v=Y({type:f,tooltip:"Библиотека цветов/текстур"}),m=Y({tooltip:"Индекс материала в MeshRenderer"}),S=Y({group:{name:"Editor"}}),P=Y({group:{name:"Editor"}}),C=Y({group:{name:"Editor"}}),_=Y({visible:!0,group:{name:"Editor"}}),N=Y({visible:!0,group:{name:"Editor"}}),z=Y({visible:!0,group:{name:"Editor"}}),d(I=h(I=y((j=t((O=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return t=e.call.apply(e,[this].concat(n))||this,o(t,"prefab",j,i(t)),o(t,"colorLib",E,i(t)),o(t,"totalObjects",L,i(t)),o(t,"objectsPerLevel",M,i(t)),o(t,"angleStep",R,i(t)),o(t,"baseScale",D,i(t)),o(t,"levelScaleFactor",F,i(t)),o(t,"baseHeight",x,i(t)),o(t,"levelPadding",T,i(t)),o(t,"materialIndex",k,i(t)),o(t,"_spawnNow",H,i(t)),o(t,"_clearNow",A,i(t)),o(t,"_recolorNow",B,i(t)),t}r(t,e);var l=t.prototype;return l.start=function(){this.spawnObjects()},l.clearSpawned=function(){this.node.removeAllChildren()},l.levelYOffset=function(e){if(e<=0)return 0;var t=this.baseHeight*this.baseScale,r=this.levelScaleFactor;return(Math.abs(1-r)<1e-6?e*t:t*(1-Math.pow(r,e))/(1-r))+e*this.levelPadding},l.getLib=function(){var e,t;return null!=(e=null!=(t=this.colorLib)?t:f.instance)?e:null},l.spawnObjects=function(){if(this.prefab)for(var e=0;e<this.totalObjects;e++){var t=Math.floor(e/this.objectsPerLevel),r=this.baseScale*Math.pow(this.levelScaleFactor,t),o=s(this.prefab);o.name="Piece_"+e,o.setParent(this.node);var i=this.levelYOffset(t);o.setPosition(new u(0,i,0)),o.setRotationFromEuler(new u(0,e*this.angleStep,0)),o.setScale(r,r,r),this.applyColorToNode(o)}else console.warn("Prefab не назначен!")},l.applyColorsToChildren=function(){for(var e,t=n(this.node.children);!(e=t()).done;){var r=e.value;this.applyColorToNode(r)}},l.applyColorToNode=function(e){var t=e.getComponent(w),r=this.getLib();if(null!=t&&t.meshRenderer&&r){var o=t.meshRenderer;o.getMaterialInstance(this.materialIndex),r.applyRandomSet(o,this.materialIndex)}},a(t,[{key:"SpawnInEditor",get:function(){return this._spawnNow},set:function(e){e&&(this.clearSpawned(),this.spawnObjects(),this._spawnNow=!1)}},{key:"ClearSpawned",get:function(){return this._clearNow},set:function(e){e&&(this.clearSpawned(),this._clearNow=!1)}},{key:"RecolorInEditor",get:function(){return this._recolorNow},set:function(e){e&&(this.applyColorsToChildren(),this._recolorNow=!1)}}]),t}(b)).prototype,"prefab",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(O.prototype,"colorLib",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(O.prototype,"totalObjects",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 24}}),M=t(O.prototype,"objectsPerLevel",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),R=t(O.prototype,"angleStep",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),D=t(O.prototype,"baseScale",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),F=t(O.prototype,"levelScaleFactor",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.9}}),x=t(O.prototype,"baseHeight",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),T=t(O.prototype,"levelPadding",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),k=t(O.prototype,"materialIndex",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),H=t(O.prototype,"_spawnNow",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),A=t(O.prototype,"_clearNow",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),B=t(O.prototype,"_recolorNow",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),t(O.prototype,"SpawnInEditor",[_],Object.getOwnPropertyDescriptor(O.prototype,"SpawnInEditor"),O.prototype),t(O.prototype,"ClearSpawned",[N],Object.getOwnPropertyDescriptor(O.prototype,"ClearSpawned"),O.prototype),t(O.prototype,"RecolorInEditor",[z],Object.getOwnPropertyDescriptor(O.prototype,"RecolorInEditor"),O.prototype),I=O))||I)||I)||I));l._RF.pop()}}}));

System.register("chunks:///_virtual/PingPongUpDown.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,o,n,s,a,r,l,p,u,h;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){s=t.cclegacy,a=t._decorator,r=t.Node,l=t.Vec3,p=t.tween,u=t.sys,h=t.Component}],execute:function(){var c,w,d,f,b,D,g,m,y,P,U,S,N,z,O,v,k,X,I,Y,R,M,x,L,A,E,T,_,B,F,H,j,q,C,V,Z,G;s._RF.push({},"39d58AdUaBHZ4SRpHBSEaIb","PingPongUpDown",void 0);var J=a.ccclass,K=a.property;t("Top4PingPongY",(c=J("Top4PingPongY"),w=K({type:r,tooltip:"ЛЕВЫЙ: старт ↑ затем ↓"}),d=K({type:r,tooltip:"ПРАВЫЙ: старт ↓ затем ↑"}),f=K({tooltip:"Амплитуда по Y (юниты/пиксели)"}),b=K({tooltip:"Время на половину цикла (сек)"}),D=K({tooltip:"Стартовая задержка (сек)"}),g=K({tooltip:"Easing (например, sineInOut / linear / quadOut)"}),m=K({tooltip:"Возвращать позицию/скейл в исходные при остановке"}),y=K({tooltip:"Запустить сразу (без события ENTERED)"}),P=K({tooltip:"Смещение по Y для ПК"}),U=K({tooltip:"Смещение по Y для мобилки"}),S=K({tooltip:"Смещение по X для ПК (ЛЕВЫЙ объект)"}),N=K({tooltip:"Смещение по X для ПК (ПРАВЫЙ объект)"}),z=K({tooltip:"Смещение по X для мобилки (ЛЕВЫЙ объект)"}),O=K({tooltip:"Смещение по X для мобилки (ПРАВЫЙ объект)"}),v=K({tooltip:"Начальный scale для ПК (1 = 100%)"}),k=K({tooltip:"Начальный scale для мобилки (1 = 100%)"}),X=K({tooltip:"Если включено — scale трактуется как множитель к скейлу из сцены"}),c((R=e((Y=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return e=t.call.apply(t,[this].concat(s))||this,o(e,"upDownNode",R,n(e)),o(e,"downUpNode",M,n(e)),o(e,"amplitude",x,n(e)),o(e,"duration",L,n(e)),o(e,"startDelay",A,n(e)),o(e,"easing",E,n(e)),o(e,"resetOnStop",T,n(e)),o(e,"startImmediately",_,n(e)),o(e,"desktopYOffset",B,n(e)),o(e,"mobileYOffset",F,n(e)),o(e,"desktopXOffsetLeft",H,n(e)),o(e,"desktopXOffsetRight",j,n(e)),o(e,"mobileXOffsetLeft",q,n(e)),o(e,"mobileXOffsetRight",C,n(e)),o(e,"desktopStartScale",V,n(e)),o(e,"mobileStartScale",Z,n(e)),o(e,"scaleIsMultiplier",G,n(e)),e.startPosUp=void 0,e.startPosDown=void 0,e.baseScaleUp=void 0,e.baseScaleDown=void 0,e.twUp=null,e.twDown=null,e}i(e,t);var s=e.prototype;return s.start=function(){this.upDownNode&&(this.startPosUp||(this.startPosUp=this.upDownNode.position.clone()),this.baseScaleUp||(this.baseScaleUp=this.upDownNode.scale.clone())),this.downUpNode&&(this.startPosDown||(this.startPosDown=this.downUpNode.position.clone()),this.baseScaleDown||(this.baseScaleDown=this.downUpNode.scale.clone()));var t=this.isMobile(),e=t?this.mobileYOffset:this.desktopYOffset,i=t?this.mobileXOffsetLeft:this.desktopXOffsetLeft;this.startPosUp&&(this.startPosUp=new l(this.startPosUp.x+i,this.startPosUp.y+e,this.startPosUp.z));var o=t?this.mobileXOffsetRight:this.desktopXOffsetRight;this.startPosDown&&(this.startPosDown=new l(this.startPosDown.x+o,this.startPosDown.y+e,this.startPosDown.z));var n=t?this.mobileStartScale:this.desktopStartScale;this.upDownNode&&this.baseScaleUp&&this.applyInitialScale(this.upDownNode,this.baseScaleUp,n),this.downUpNode&&this.baseScaleDown&&this.applyInitialScale(this.downUpNode,this.baseScaleDown,n),this.startImmediately?this.entered():this.exited()},s.onDestroy=function(){this.stopAll(!0)},s.entered=function(){this.upDownNode&&(this.upDownNode.active=!0,this.startPosUp&&this.upDownNode.setPosition(this.startPosUp),this.twUp=this.makePingPong(this.upDownNode,!0,this.startPosUp)),this.downUpNode&&(this.downUpNode.active=!0,this.startPosDown&&this.downUpNode.setPosition(this.startPosDown),this.twDown=this.makePingPong(this.downUpNode,!1,this.startPosDown))},s.exited=function(){this.stopAll(this.resetOnStop),this.upDownNode&&(this.upDownNode.active=!1),this.downUpNode&&(this.downUpNode.active=!1)},s.stopAll=function(t){this.twUp&&(this.twUp.stop(),this.twUp=null),this.twDown&&(this.twDown.stop(),this.twDown=null),t&&(this.upDownNode&&this.startPosUp&&this.upDownNode.setPosition(this.startPosUp),this.downUpNode&&this.startPosDown&&this.downUpNode.setPosition(this.startPosDown),this.upDownNode&&this.baseScaleUp&&this.upDownNode.setScale(this.baseScaleUp),this.downUpNode&&this.baseScaleDown&&this.downUpNode.setScale(this.baseScaleDown))},s.makePingPong=function(t,e,i){var o=new l(i.x,i.y+this.amplitude,i.z),n=new l(i.x,i.y-this.amplitude,i.z),s=e?o:n;return p(t).delay(this.startDelay).to(this.duration,{position:s},{easing:this.easing}).to(this.duration,{position:i},{easing:this.easing}).union().repeatForever().start()},s.applyInitialScale=function(t,e,i){this.scaleIsMultiplier?t.setScale(new l(e.x*i,e.y*i,e.z*i)):t.setScale(new l(i,i,i))},s.isMobile=function(){var t="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(pointer: coarse)").matches;return!!u.isMobile||t},e}(h)).prototype,"upDownNode",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(Y.prototype,"downUpNode",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(Y.prototype,"amplitude",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),L=e(Y.prototype,"duration",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.8}}),A=e(Y.prototype,"startDelay",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),E=e(Y.prototype,"easing",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"sineInOut"}}),T=e(Y.prototype,"resetOnStop",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_=e(Y.prototype,"startImmediately",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),B=e(Y.prototype,"desktopYOffset",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),F=e(Y.prototype,"mobileYOffset",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),H=e(Y.prototype,"desktopXOffsetLeft",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-2}}),j=e(Y.prototype,"desktopXOffsetRight",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),q=e(Y.prototype,"mobileXOffsetLeft",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-2}}),C=e(Y.prototype,"mobileXOffsetRight",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),V=e(Y.prototype,"desktopStartScale",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Z=e(Y.prototype,"mobileStartScale",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),G=e(Y.prototype,"scaleIsMultiplier",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),I=Y))||I));s._RF.pop()}}}));

System.register("chunks:///_virtual/PlatformCameraSwitcher.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,r,i,n,a,l,c,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){n=t.cclegacy,a=t._decorator,l=t.Node,c=t.sys,s=t.Component}],execute:function(){var p,u,f,h,b,y,m;n._RF.push({},"339078DsVBDcqU199OGeGSu","PlatformCameraSwitcher",void 0);var d=a.ccclass,R=a.property;t("MobileOrDesktopSwitcher",(p=d("MobileOrDesktopSwitcher"),u=R({type:l}),f=R({type:l}),p((y=e((b=function(t){function e(){for(var e,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return e=t.call.apply(t,[this].concat(n))||this,r(e,"mobileRoot",y,i(e)),r(e,"desktopRoot",m,i(e)),e}return o(e,t),e.prototype.start=function(){var t=c.isMobile;this.mobileRoot&&(this.mobileRoot.active=t),this.desktopRoot&&(this.desktopRoot.active=!t)},e}(s)).prototype,"mobileRoot",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(b.prototype,"desktopRoot",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h=b))||h));n._RF.pop()}}}));

System.register("chunks:///_virtual/PointerIds.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"13922PSQAhJcJjhZ5FF88EN","PointerIds",void 0);t("MOUSE_ID",-1);e._RF.pop()}}}));

System.register("chunks:///_virtual/RemoteTextureToMaterial.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,a,i,o,s,u,c,p,l,f,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,a=e.assertThisInitialized,i=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){s=e.cclegacy,u=e._decorator,c=e.RenderableComponent,p=e.Component,l=e.Material,f=e.Texture2D,m=e.ImageAsset}],execute:function(){var h,b,g,x,d,v,y,w,I,R,T;s._RF.push({},"eb3cahjlTZI1qWPqNcjurEl","RemoteTextureToMaterial",void 0);var M=u.ccclass,_=u.property;function k(e,t){return void 0===t&&(t="image/png"),e.startsWith("data:")?e:"data:"+t+";base64,"+e}function B(e){return z.apply(this,arguments)}function z(){return(z=i(o().mark((function e(t){var r,n,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("createImageBitmap"in window)){e.next=11;break}return e.next=3,fetch(t);case 3:return r=e.sent,e.next=6,r.blob();case 6:return n=e.sent,e.next=9,createImageBitmap(n);case 9:return a=e.sent,e.abrupt("return",new m(a));case 11:return e.next=13,new Promise((function(e,r){var n=new Image;n.onload=function(){return e(n)},n.onerror=r,n.src=t}));case 13:return i=e.sent,e.abrupt("return",new m(i));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return F.apply(this,arguments)}function F(){return(F=i(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t);case 2:return r=e.sent,(n=new f).image=r,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e("ReplaceTextureFromBase64",(h=M("ReplaceTextureFromBase64"),b=_({tooltip:"���� ����� �������� data URL ��� �������� base64-������"}),g=_({tooltip:"MIME ��� ��� ����� base64 (���� �� data:). �������� image/png, image/jpeg, image/webp"}),x=_({type:c,tooltip:"������-��������� � ��� ����������� ����������"}),d=_({tooltip:"��� texture-������� (albedoMap | mainTexture � �.�.)"}),h((w=t((y=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i))||this,n(t,"base64Input",w,a(t)),n(t,"mimeHint",I,a(t)),n(t,"target",R,a(t)),n(t,"uniformName",T,a(t)),t._tex=void 0,t}r(t,e);var s=t.prototype;return s.onLoad=function(){this.target||(this.target=this.getComponent(c))},s.start=function(){var e=i(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.base64Input){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.applyBase64(this.base64Input,this.mimeHint);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("[ReplaceTextureFromBase64] failed:",e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(){return e.apply(this,arguments)}}(),s.applyBase64=function(){var e=i(o().mark((function e(t,r){var n,a,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r="image/png"),n=k(t,r),e.next=4,D(n);case 4:if(this._tex=e.sent,a=this.target.getMaterialInstance(0)){e.next=12;break}if(s=null==(i=this.target.sharedMaterials)?void 0:i[0]){e.next=10;break}throw new Error("� ������� ��� ���������");case 10:a=new l(s),this.target.setMaterial(a,0);case 12:a.setProperty(this.uniformName,this._tex);case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),s.onDestroy=function(){if(this._tex){var e=this._tex.image;null!=e&&e.decRef&&e.decRef(),this._tex.destroy(),this._tex=void 0}},t}(p)).prototype,"base64Input",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),I=t(y.prototype,"mimeHint",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"image/png"}}),R=t(y.prototype,"target",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=t(y.prototype,"uniformName",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"albedoMap"}}),v=y))||v));s._RF.pop()}}}));

System.register("chunks:///_virtual/RotateYByKeys.ts",["./rollupPluginModLoBabelHelpers.js","cc","./InteractionState.ts","./PointerIds.ts"],(function(t){var e,i,o,s,n,h,u,r,a,c,l,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,s=t.assertThisInitialized},function(t){n=t.cclegacy,h=t._decorator,u=t.input,r=t.Input,a=t.KeyCode,c=t.Component},function(t){l=t.InteractionState},function(t){g=t.MOUSE_ID}],execute:function(){var m,v,f,D,p,d,y,T,E,A,b,k,M,S,_,C,O,L,X;n._RF.push({},"717452jV8ZDv7JZnElpm+X0","RotateYByKeys",void 0);var H=h.ccclass,I=h.property;t("RotateYByKeys",(m=H("RotateYByKeys"),v=I({tooltip:"Скорость вращения от клавиш (град/сек)"}),f=I({tooltip:"Чувствительность драга: градусов на 1 пиксель"}),D=I({tooltip:"Порог пикселей, после которого считаем жест drag"}),p=I({tooltip:"Мёртвая зона по углу: пока |Δугол| меньше — не вращаем"}),d=I({tooltip:"Плавность вращения (сек) — и разгон, и отпускание"}),y=I({tooltip:"Инвертировать направление вращения"}),T=I({tooltip:"Градусов на 1 «тик» колесика/тачпада (delta=120). Для трекпада подберите 0.5–2.5"}),E=I({tooltip:"Фильтр мелких движений трекпада: минимальный поворот (°) за событие"}),m((k=e((b=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),h=0;h<i;h++)n[h]=arguments[h];return e=t.call.apply(t,[this].concat(n))||this,o(e,"rotateSpeed",k,s(e)),o(e,"degPerPixel",M,s(e)),o(e,"dragThreshold",S,s(e)),o(e,"startMoveOffsetDeg",_,s(e)),o(e,"angularSmoothTime",C,s(e)),o(e,"invert",O,s(e)),o(e,"degPerWheelTick",L,s(e)),o(e,"wheelMinStepDeg",X,s(e)),e.keyDir=0,e.kbAccumDeg=0,e.kbActive=!1,e.keyLeftHeld=!1,e.keyRightHeld=!1,e.activeTouchId=null,e.touchStartX=null,e.touchLastX=null,e.touchDragging=!1,e.touchAccumDeg=0,e.touchActive=!1,e.touchClaimed=!1,e.mouseHeld=!1,e.mouseStartX=null,e.mouseLastX=null,e.mouseDragging=!1,e.mouseAccumDeg=0,e.mouseActive=!1,e.mouseClaimed=!1,e.angVel=0,e.pendingDegFromPointer=0,e}i(e,t);var n=e.prototype;return n._recalcKeyDir=function(){var t=(this.keyRightHeld?1:0)+(this.keyLeftHeld?-1:0);this.keyDir=t,0===this.keyDir&&(this.kbAccumDeg=0,this.kbActive=!1)},n._resetInteractionIfStuck=function(){l.hardReset()},n.stopInertia=function(){this.angVel=0,this.pendingDegFromPointer=0,this.keyDir=0,this.kbAccumDeg=0,this.kbActive=!1,this.keyLeftHeld=!1,this.keyRightHeld=!1,this.mouseHeld=!1,this.mouseDragging=!1,this.mouseAccumDeg=0,this.mouseActive=!1,this.mouseClaimed=!1,this.touchDragging=!1,this.touchAccumDeg=0,this.touchActive=!1,this.touchClaimed=!1},n.onEnable=function(){this._resetInteractionIfStuck(),u.on(r.EventType.KEY_DOWN,this.onKeyDown,this),u.on(r.EventType.KEY_UP,this.onKeyUp,this),u.on(r.EventType.TOUCH_START,this.onTouchStart,this),u.on(r.EventType.TOUCH_MOVE,this.onTouchMove,this),u.on(r.EventType.TOUCH_END,this.onTouchEnd,this),u.on(r.EventType.TOUCH_CANCEL,this.onTouchCancel,this),u.on(r.EventType.MOUSE_DOWN,this.onMouseDown,this),u.on(r.EventType.MOUSE_MOVE,this.onMouseMove,this),u.on(r.EventType.MOUSE_UP,this.onMouseUp,this),u.on(r.EventType.MOUSE_WHEEL,this.onWheel,this)},n.onDisable=function(){u.off(r.EventType.KEY_DOWN,this.onKeyDown,this),u.off(r.EventType.KEY_UP,this.onKeyUp,this),u.off(r.EventType.TOUCH_START,this.onTouchStart,this),u.off(r.EventType.TOUCH_MOVE,this.onTouchMove,this),u.off(r.EventType.TOUCH_END,this.onTouchEnd,this),u.off(r.EventType.TOUCH_CANCEL,this.onTouchCancel,this),u.off(r.EventType.MOUSE_DOWN,this.onMouseDown,this),u.off(r.EventType.MOUSE_MOVE,this.onMouseMove,this),u.off(r.EventType.MOUSE_UP,this.onMouseUp,this),u.off(r.EventType.MOUSE_WHEEL,this.onWheel,this)},n.onKeyDown=function(t){var e;switch(null==(e=t.event)||null==e.preventDefault||e.preventDefault(),t.keyCode){case a.KEY_A:case a.ARROW_LEFT:this.keyLeftHeld=!0;break;case a.KEY_D:case a.ARROW_RIGHT:this.keyRightHeld=!0;break;default:return}this._recalcKeyDir()},n.onKeyUp=function(t){var e;switch(null==(e=t.event)||null==e.preventDefault||e.preventDefault(),t.keyCode){case a.KEY_A:case a.ARROW_LEFT:this.keyLeftHeld=!1;break;case a.KEY_D:case a.ARROW_RIGHT:this.keyRightHeld=!1;break;default:return}this._recalcKeyDir()},n.onTouchStart=function(t){if((!l.inGesture||"touch"!==l.source)&&null===this.activeTouchId){var e=t.getID();this.activeTouchId=e;var i=t.getLocationX();this.touchStartX=i,this.touchLastX=i,this.touchDragging=!1,this.touchAccumDeg=0,this.touchActive=!1,this.touchClaimed=!1}},n.onTouchMove=function(t){var e=t.getID();if(this.activeTouchId===e&&null!==this.touchLastX&&null!==this.touchStartX&&(!l.inGesture||"touch"!==l.source||this.touchClaimed)){var i=t.getLocationX(),o=i-this.touchLastX,s=i-this.touchStartX;if(this.touchLastX=i,!this.touchDragging&&Math.abs(s)>=this.dragThreshold&&(this.touchDragging=!0),0!==o){var n=this.invert?-1:1,h=o*this.degPerPixel*n;if(!this.touchActive){if(this.touchAccumDeg+=h,!(this.touchDragging&&Math.abs(this.touchAccumDeg)>=this.startMoveOffsetDeg))return;if(l.inGesture)return;this.touchActive=!0,l.beginGesture(e,"touch"),this.touchClaimed=!0,l.markDrag(e)}this.touchClaimed&&(this.pendingDegFromPointer+=h)}}},n.onTouchEnd=function(t){this.activeTouchId===t.getID()&&(this.touchClaimed&&l.tryEndGesture(t.getID(),"touch"),this.activeTouchId=null,this.touchStartX=this.touchLastX=null,this.touchDragging=!1,this.touchAccumDeg=0,this.touchActive=!1,this.touchClaimed=!1)},n.onTouchCancel=function(t){this.activeTouchId===t.getID()&&(this.touchClaimed&&l.tryEndGesture(t.getID(),"touch"),this.activeTouchId=null,this.touchStartX=this.touchLastX=null,this.touchDragging=!1,this.touchAccumDeg=0,this.touchActive=!1,this.touchClaimed=!1)},n.onMouseDown=function(t){if(0===t.getButton()){this.mouseHeld=!0;var e=t.getLocationX();this.mouseStartX=e,this.mouseLastX=e,this.mouseDragging=!1,this.mouseAccumDeg=0,this.mouseActive=!1,this.mouseClaimed=!1}},n.onMouseMove=function(t){if(this.mouseHeld&&null!==this.mouseLastX&&null!==this.mouseStartX){var e=t.getLocationX(),i=e-this.mouseLastX,o=e-this.mouseStartX;if(this.mouseLastX=e,!this.mouseDragging&&Math.abs(o)>=this.dragThreshold&&(this.mouseDragging=!0),0!==i){var s=this.invert?-1:1,n=i*this.degPerPixel*s;if(!this.mouseActive){if(this.mouseAccumDeg+=n,!(this.mouseDragging&&Math.abs(this.mouseAccumDeg)>=this.startMoveOffsetDeg))return;this.mouseActive=!0,l.inGesture||(l.beginGesture(g,"mouse"),this.mouseClaimed=!0),l.markDrag(g)}this.pendingDegFromPointer+=n}}},n.onMouseUp=function(t){0===t.getButton()&&(this.mouseClaimed&&l.tryEndGesture(g,"mouse"),this.mouseHeld=!1,this.mouseStartX=this.mouseLastX=null,this.mouseDragging=!1,this.mouseAccumDeg=0,this.mouseActive=!1,this.mouseClaimed=!1)},n.onWheel=function(t){var e;null==(e=t.event)||null==e.preventDefault||e.preventDefault();var i=t.getScrollX();if(0!==i){var o=i/120,s=this.invert?-1:1,n=-o*this.degPerWheelTick*s;Math.abs(n)<this.wheelMinStepDeg||(this.pendingDegFromPointer+=n,this.mouseActive=!0)}},n.update=function(t){var e=this.invert?-1:1;0!==this.keyDir?this.kbActive||(this.kbAccumDeg+=Math.abs(this.rotateSpeed*t),this.kbAccumDeg>=this.startMoveOffsetDeg&&(this.kbActive=!0)):(this.kbAccumDeg=0,this.kbActive=!1);var i=0!==this.keyDir&&this.kbActive?this.rotateSpeed*this.keyDir*e:0,o=this.pendingDegFromPointer/Math.max(t,1e-5);this.pendingDegFromPointer=0;var s=i+o,n=this.angularSmoothTime>0?1-Math.exp(-t/this.angularSmoothTime):1;if(this.angVel+=(s-this.angVel)*n,0!==this.angVel){var h=this.node.eulerAngles;h.y+=this.angVel*t,this.node.setRotationFromEuler(h)}var u=this.mouseActive||this.touchActive||0!==this.keyDir&&this.kbActive;l.inGesture||u||!l.isRotating||(l.isRotating=!1),this.mouseActive=!1,!u&&Math.abs(this.angVel)<.05&&(this.angVel=0)},e}(c)).prototype,"rotateSpeed",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),M=e(b.prototype,"degPerPixel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),S=e(b.prototype,"dragThreshold",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 12}}),_=e(b.prototype,"startMoveOffsetDeg",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),C=e(b.prototype,"angularSmoothTime",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),O=e(b.prototype,"invert",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),L=e(b.prototype,"degPerWheelTick",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),X=e(b.prototype,"wheelMinStepDeg",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),A=b))||A));n._RF.pop()}}}));

System.register("chunks:///_virtual/StartApp.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(n){var t,o,c,r,e;return{setters:[function(n){t=n.inheritsLoose},function(n){o=n.cclegacy,c=n._decorator,r=n.game,e=n.Component}],execute:function(){var u;o._RF.push({},"03b4cr8mr5ANqGQ5koPtIAX","StartApp",void 0);var i=c.ccclass;n("UncapFPS",i("UncapFPS")(u=function(n){function o(){return n.apply(this,arguments)||this}return t(o,n),o.prototype.start=function(){r.setFrameRate(360),CC_DEBUG||(console.log=function(){},console.warn=function(){},console.error=function(){},cc.log=function(){},cc.warn=function(){},cc.error=function(){})},o}(e))||u);o._RF.pop()}}}));

System.register("chunks:///_virtual/TowerQueriesTester.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TVS_SpawnLayout.ts","./GlobalClickManager.ts","./ClickMoveBinding.ts"],(function(e){var t,n,r,l,a,o,u,i,s,c,p,d,f,y;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,l=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){u=e.cclegacy,i=e._decorator,s=e.Component,c=e.sys,p=e.director},function(e){d=e.TowerLayoutController},function(e){f=e.GlobalClickManager3D},function(e){y=e.ClickMoveBinding}],execute:function(){var h,v,b,g,k,P,m;u._RF.push({},"3f79avZs1VNjqUdXTzvv1Oa","TowerQueriesTester",void 0);var x=i.ccclass,C=i.property;e("OpenPieceBridge",(h=x("OpenPieceBridge"),v=C({type:d}),b=C({type:f}),h((P=t((k=function(e){function t(){for(var t,n=arguments.length,u=new Array(n),i=0;i<n;i++)u[i]=arguments[i];return t=e.call.apply(e,[this].concat(u))||this,r(t,"layoutCtrl",P,l(t)),r(t,"clickMgr",m,l(t)),t.allowedParents=new Set([]),t.lastBusy=null,t.onMessage=a(o().mark((function e(n){var r,l,a,u,i,s,c,p,d,f,y,h,v,b,g,k,P,m,x,C,O;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.allowedParents.size||t.allowedParents.has(n.origin)){e.next=2;break}return e.abrupt("return");case 2:r=n.data||{},e.t0=r.type,e.next="QUERY_BUSY"===e.t0?6:"QUERY_INFO"===e.t0?8:"OPEN_RANDOM"===e.t0?11:"OPEN_BY_UNIQ"===e.t0?16:"OPEN_BY_USER"===e.t0?22:"CLOSE_OPENED"===e.t0||"CLOSE_ANY"===e.t0?28:"RELOAD_SCENE"===e.t0?33:38;break;case 6:return t.reply(n,"BUSY_STATE",{busy:t.isBusy()}),e.abrupt("break",38);case 8:return u=null!=(l=null==(a=t.layoutCtrl)||null==a.getPiecesCount?void 0:a.getPiecesCount())?l:0,t.reply(n,"INFO",{piecesCount:u}),e.abrupt("break",38);case 11:return e.next=13,t.openRandom();case 13:return i=e.sent,t.reply(n,"OPEN_RESULT",{ok:i,mode:"random"}),e.abrupt("break",38);case 16:return f=null!=(s=null!=(c=null==r||null==(p=r.payload)?void 0:p.uniqId)?c:null==r||null==(d=r.payload)?void 0:d.uniq_id)?s:"",e.next=19,t.openByUniqId(f);case 19:return y=e.sent,t.reply(n,"OPEN_RESULT",{ok:y,mode:"byUniq",uniqId:f}),e.abrupt("break",38);case 22:return m=null!=(h=null!=(v=null!=(b=null==r||null==(g=r.payload)?void 0:g.userId)?b:null==r||null==(k=r.payload)?void 0:k.uniqId)?v:null==r||null==(P=r.payload)?void 0:P.uniq_id)?h:"",e.next=25,t.openByUniqId(m);case 25:return x=e.sent,t.reply(n,"OPEN_RESULT",{ok:x,mode:"byUniq",uniqId:m,deprecated:"OPEN_BY_USER"}),e.abrupt("break",38);case 28:return e.next=30,t.closeOpened();case 30:return C=e.sent,t.reply(n,"CLOSE_RESULT",{ok:C}),e.abrupt("break",38);case 33:return e.next=35,t.reloadScene();case 35:return O=e.sent,t.reply(n,"RELOAD_RESULT",{ok:O}),e.abrupt("break",38);case 38:case"end":return e.stop()}}),e)}))),t}n(t,e);var u=t.prototype;return u.onEnable=function(){window.addEventListener("message",this.onMessage)},u.onDisable=function(){try{this.safePostToParent({type:"IFRAME_GOING_AWAY"})}catch(e){}window.removeEventListener("message",this.onMessage)},u.update=function(){var e=this.isBusy();e!==this.lastBusy&&(this.lastBusy=e,this.safePostToParent({type:"BUSY_STATE",payload:{busy:e}}))},u.safePostToParent=function(e,t){void 0===t&&(t="*"),console.log(e);try{var n;null==(n=window.parent)||n.postMessage(e,t)}catch(e){}},u.reply=function(e,t,n){this.safePostToParent({type:t,payload:n},e.origin||"*")},u.isBusy=function(){var e=this.clickMgr;return!e||"Idle"!==e.fsm},u.buildPiecePayload=function(e,t){var n=this.layoutCtrl;try{var r,l,a,o,u,i,s=n.levelSlotToDataIndex(e,t),c=s>=0?n.getPieceByDataIndex(s):null;return{level:e,slot:t,dataIndex:s,piece:c?{uniq_id:null!=(r=c.uniq_id)?r:null,hex_color:null!=(l=c.hex_color)?l:null,name:null!=(a=c.name)?a:null,filling_id:null!=(o=c.filling_id)?o:null,file:null!=(u=c.file)?u:null,greeting_text:null!=(i=c.greeting_text)?i:null}:null}}catch(n){return{level:e,slot:t,dataIndex:-1,piece:null}}},u.ensureReadyForOpen=function(){var e=a(o().mark((function e(){var t,n,r,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.clickMgr){e.next=3;break}return e.abrupt("return",!1);case 3:if("LockedOut"!==t.fsm){e.next=20;break}return n=null==t?void 0:t.clickedLevel,r=null==t?void 0:t.clickedSlot,l="number"==typeof n&&"number"==typeof r?this.buildPiecePayload(n,r):null,e.prev=7,e.next=10,null==t.closeAndInsert?void 0:t.closeAndInsert();case 10:this.safePostToParent({type:"CLOSED",payload:null!=l?l:{level:n,slot:r},meta:{reason:"switch"}}),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(7),console.warn("[OpenPieceBridge] не удалось закрыть перед открытием:",e.t0),e.abrupt("return",!1);case 17:return e.prev=17,t.fsm="Idle",e.finish(17);case 20:return e.abrupt("return","Idle"===t.fsm);case 21:case"end":return e.stop()}}),e,this,[[7,13,17,20]])})));return function(){return e.apply(this,arguments)}}(),u.openRandom=function(){var e=a(o().mark((function e(){var t,n,r,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layoutCtrl,n=this.clickMgr,t&&n&&n.scrollCtrl&&n.rotatingRoot){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,this.ensureReadyForOpen();case 6:if(e.sent){e.next=8;break}return e.abrupt("return",!1);case 8:if(r=4294967295*Math.random()>>>0,l=t.scrollToRandomPiece({duration:n.heightCenterDuration,easing:"quadOut",clamp:!0,seed:r})){e.next=12;break}return e.abrupt("return",!1);case 12:return e.next=14,this.openAt(l.level,l.slot);case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.openByUniqId=function(){var e=a(o().mark((function e(t){var n,r,l,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.layoutCtrl,r=this.clickMgr,n&&r&&r.scrollCtrl&&r.rotatingRoot){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,this.ensureReadyForOpen();case 6:if(e.sent){e.next=8;break}return e.abrupt("return",!1);case 8:if(l=(null!=t?t:"").trim()){e.next=11;break}return e.abrupt("return",!1);case 11:if(a=n.findLevelSlotByUniqId(l)){e.next=15;break}return console.warn("[OpenPieceBridge] uniq_id не найден:",l),e.abrupt("return",!1);case 15:return e.next=17,this.openAt(a.level,a.slot);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),u.openAt=function(){var e=a(o().mark((function e(t,n){var r,l,a,u,i,s,p,d,f,h,v,b,g,k,P;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.layoutCtrl,l=this.clickMgr,e.prev=2,null==l.lockControls||l.lockControls(),l.clickedLevel=t,l.clickedSlot=n,l.fsm="Aligning",s=this.buildPiecePayload(t,n),this.safePostToParent({type:"OPENING",payload:s}),p=!!c.isMobile,d=p&&null!=(a=l.levelBiasTopMobile)?a:l.levelBiasTop,f=p&&null!=(u=l.levelBiasRestMobile)?u:l.levelBiasRest,h=t<=1?d:f,v=r.getLevelStep(),b=(t+h)*v,g=p?7:5,null==r.ensureBottomPaddingForHeight||r.ensureBottomPaddingForHeight(b,g),null==l.scrollCtrl.pushUnclamped||l.scrollCtrl.pushUnclamped(!0),e.prev=18,e.next=21,l.scrollCtrl.scrollToHeightWithNudgeAsync(b,l.heightCenterDuration,l.heightNudgeDuration,"quadOut",!1);case 21:return e.prev=21,null==l.scrollCtrl.popUnclamped||l.scrollCtrl.popUnclamped(),e.finish(21);case 24:return e.next=26,null==l.rotateRootToBringSlotToCamera?void 0:l.rotateRootToBringSlotToCamera(n);case 26:if(k=r.findNodeByLevelSlot(t,n)){e.next=31;break}return null==l.unlockControls||l.unlockControls(),l.fsm="Idle",e.abrupt("return",!1);case 31:return P=k.getComponent(y)||k.getComponentInChildren(y),l.currentPiece=k,l.currentBinding=P,null==l.applyImageToCurrentPiece||l.applyImageToCurrentPiece(t,n),e.next=37,null==l.slideOutWithScaleComp?void 0:l.slideOutWithScaleComp();case 37:return null==l.setRimActive||l.setRimActive(!0),null==l.showBloor||l.showBloor(),e.next=41,null==l.rotateModelOpen?void 0:l.rotateModelOpen();case 41:return null==(i=l.currentBinding)||null==i.playSequence||i.playSequence(),this.safePostToParent({type:"OPENED",payload:s}),l.fsm="LockedOut",e.abrupt("return",!0);case 47:e.prev=47,e.t0=e.catch(2),console.warn("[OpenPieceBridge] ошибка открытия:",e.t0);try{null==l.unlockControls||l.unlockControls()}catch(e){}return l.fsm="Idle",this.safePostToParent({type:"OPEN_FAILED",payload:{level:t,slot:n,error:String(e.t0||"unknown")}}),e.abrupt("return",!1);case 54:case"end":return e.stop()}}),e,this,[[2,47],[18,,21,24]])})));return function(t,n){return e.apply(this,arguments)}}(),u.closeOpened=function(){var e=a(o().mark((function e(){var t,n,r,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.clickMgr){e.next=3;break}return e.abrupt("return",!1);case 3:if(n=null==t?void 0:t.clickedLevel,r=null==t?void 0:t.clickedSlot,l="number"==typeof n&&"number"==typeof r?this.buildPiecePayload(n,r):null,"LockedOut"!==t.fsm){e.next=11;break}return e.next=9,null==t.closeAndInsert?void 0:t.closeAndInsert();case 9:return this.safePostToParent({type:"CLOSED",payload:null!=l?l:{level:n,slot:r}}),e.abrupt("return",!0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.reloadScene=function(){var e=a(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.safePostToParent({type:"RELOAD_START"}),t=p.getScene(),!(n=null==t?void 0:t.name)){e.next=7;break}return p.loadScene(n),e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 10:return e.prev=10,e.t0=e.catch(0),console.warn("[OpenPieceBridge] ошибка перезагрузки сцены:",e.t0),this.safePostToParent({type:"RELOAD_FAILED",payload:{error:String(e.t0||"unknown")}}),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),t}(s)).prototype,"layoutCtrl",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=t(k.prototype,"clickMgr",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=k))||g));u._RF.pop()}}}));

System.register("chunks:///_virtual/TowerScrollController.ts",["./rollupPluginModLoBabelHelpers.js","cc","./InteractionState.ts","./PingPongUpDown.ts","./PointerIds.ts"],(function(t){var e,i,s,n,o,l,r,h,a,c,u,f,p,m,v,d,g,E,y;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.createClass,s=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,l=t.asyncToGenerator,r=t.regeneratorRuntime},function(t){h=t.cclegacy,a=t._decorator,c=t.EventTarget,u=t.input,f=t.Input,p=t.tween,m=t.KeyCode,v=t.Component,d=t.sys},function(t){g=t.InteractionState},function(t){E=t.Top4PingPongY},function(t){y=t.MOUSE_ID}],execute:function(){var b,T,_,O,w,S,M,D,x,A,C,I,U,P,k,Y,R,z,H,L,W,K,N,V,G,q,B,F,X,j,J,Q,Z,$,tt,et,it,st,nt,ot,lt,rt,ht,at,ct,ut,ft,pt,mt,vt,dt,gt;h._RF.push({},"10ce5Y/EABEKJf4+gRbbg26","TowerScrollController",void 0);var Et=a.ccclass,yt=a.property,bt=y,Tt=t("TVS_Scroll",(b=Et("TVS_Scroll"),T=yt({tooltip:"Стартовый offset (ед.) для ПК"}),_=yt({tooltip:"Стартовый offset (ед.) для мобилы"}),O=yt({tooltip:"Мин. offset для ПК"}),w=yt({tooltip:"Мин. offset для мобилы"}),S=yt({tooltip:"Порог offset (ПК): ниже/равно — считаем, что на самом верху (ENTERED)"}),M=yt({tooltip:"Порог offset (Мобила): ниже/равно — считаем, что на самом верху (ENTERED)"}),D=yt({tooltip:"Порог offset (ПК): выше — выходим из состояния самого верха (EXITED). Должен быть >= topEnterOffset"}),x=yt({tooltip:"Порог offset (Мобила): выше — выходим из состояния самого верха (EXITED). Должен быть >= topEnterOffset"}),A=yt({tooltip:"Макс. offset"}),C=yt({tooltip:"Ед. offset на пиксель драга"}),I=yt({tooltip:"Ед. offset на шаг колёсика (120 тиков)"}),U=yt({tooltip:"Порог пикселей, после которого считаем drag и захватываем жест"}),P=yt({tooltip:"Включить инерционный доезд"}),k=yt({tooltip:"Коэф. трения (1/сек): больше — быстрее останавливается"}),Y=yt({tooltip:"Порог остановки (ед./сек)"}),R=yt({tooltip:"Сила «пинка» от колеса (в скорость)"}),z=yt({tooltip:"Максимальная скорость инерции/клавиш (ед./сек)"}),H=yt({tooltip:"Deadzone для колеса (ед. offset)"}),L=yt({tooltip:"Сброс deadzone, если колёсико молчит (мс)"}),W=yt({tooltip:"Ускорение при удержании W/S (ед./сек^2)"}),K=yt({tooltip:"Макс. скорость от W/S"}),b((G=e((V=function(){function t(){n(this,"startOffsetPC",G,this),n(this,"startOffsetMobile",q,this),n(this,"minOffsetPC",B,this),n(this,"minOffsetMobile",F,this),n(this,"topEnterOffsetPC",X,this),n(this,"topEnterOffsetMobile",j,this),n(this,"topExitOffsetPC",J,this),n(this,"topExitOffsetMobile",Q,this),n(this,"maxOffset",Z,this),n(this,"unitsPerPixel",$,this),n(this,"unitsPerWheelTick",tt,this),n(this,"dragThreshold",et,this),n(this,"enableInertia",it,this),n(this,"friction",st,this),n(this,"stopVelocity",nt,this),n(this,"wheelKick",ot,this),n(this,"maxInertiaSpeed",lt,this),n(this,"wheelDeadzoneUnits",rt,this),n(this,"wheelDeadzoneResetMs",ht,this),n(this,"keyAccel",at,this),n(this,"keyMaxSpeed",ct,this)}return i(t,[{key:"startOffset",get:function(){return d.isMobile?this.startOffsetMobile:this.startOffsetPC}},{key:"minOffset",get:function(){return d.isMobile?this.minOffsetMobile:this.minOffsetPC}},{key:"topEnterOffset",get:function(){return d.isMobile?this.topEnterOffsetMobile:this.topEnterOffsetPC}},{key:"topExitOffset",get:function(){return d.isMobile?this.topExitOffsetMobile:this.topExitOffsetPC}}]),t}()).prototype,"startOffsetPC",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),q=e(V.prototype,"startOffsetMobile",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B=e(V.prototype,"minOffsetPC",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1e12}}),F=e(V.prototype,"minOffsetMobile",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1e12}}),X=e(V.prototype,"topEnterOffsetPC",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),j=e(V.prototype,"topEnterOffsetMobile",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),J=e(V.prototype,"topExitOffsetPC",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),Q=e(V.prototype,"topExitOffsetMobile",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),Z=e(V.prototype,"maxOffset",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e12}}),$=e(V.prototype,"unitsPerPixel",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.02}}),tt=e(V.prototype,"unitsPerWheelTick",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),et=e(V.prototype,"dragThreshold",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),it=e(V.prototype,"enableInertia",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),st=e(V.prototype,"friction",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),nt=e(V.prototype,"stopVelocity",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.002}}),ot=e(V.prototype,"wheelKick",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),lt=e(V.prototype,"maxInertiaSpeed",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),rt=e(V.prototype,"wheelDeadzoneUnits",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ht=e(V.prototype,"wheelDeadzoneResetMs",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),at=e(V.prototype,"keyAccel",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 120}}),ct=e(V.prototype,"keyMaxSpeed",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),N=V))||N));t("TowerScrollController",(ut=Et("TowerScrollController"),ft=yt({type:Tt}),pt=yt({type:E,tooltip:"Опционально: кому слать ENTERED/EXITED напрямую"}),ut((dt=e((vt=function(t){function e(){for(var e,i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s))||this,n(e,"scroll",dt,o(e)),n(e,"top4Target",gt,o(e)),e.events=new c,e.atTopEntered=null,e._offset=0,e.velocity=0,e.inertiaActive=!1,e._inputEnabled=!0,e.mouseHeld=!1,e.mouseStartY=null,e.mouseLastY=null,e.mouseDragging=!1,e.mouseActive=!1,e.mouseClaimed=!1,e.touchId=null,e.touchStartY=null,e.touchLastY=null,e.touchDragging=!1,e.touchActive=!1,e.touchClaimed=!1,e.moveSamples=[],e.maxSamples=6,e.wheelAccumUnits=0,e.wheelDeadzoneLastTs=0,e.keyHeldW=!1,e.keyHeldS=!1,e.scrollTween=null,e._tweenDriver=null,e._pendingResolve=null,e._suppressEdgeLogic=!1,e._limitsStack=[],e}s(e,t);var h=e.prototype;return h.onEnable=function(){g.hardReset(),u.on(f.EventType.MOUSE_DOWN,this.onMouseDown,this),u.on(f.EventType.MOUSE_MOVE,this.onMouseMove,this),u.on(f.EventType.MOUSE_UP,this.onMouseUp,this),u.on(f.EventType.MOUSE_WHEEL,this.onWheel,this),u.on(f.EventType.TOUCH_START,this.onTouchStart,this),u.on(f.EventType.TOUCH_MOVE,this.onTouchMove,this),u.on(f.EventType.TOUCH_END,this.onTouchEnd,this),u.on(f.EventType.TOUCH_CANCEL,this.onTouchCancel,this),u.on(f.EventType.KEY_DOWN,this.onKeyDown,this),u.on(f.EventType.KEY_UP,this.onKeyUp,this)},h.onDisable=function(){u.off(f.EventType.MOUSE_DOWN,this.onMouseDown,this),u.off(f.EventType.MOUSE_MOVE,this.onMouseMove,this),u.off(f.EventType.MOUSE_UP,this.onMouseUp,this),u.off(f.EventType.MOUSE_WHEEL,this.onWheel,this),u.off(f.EventType.TOUCH_START,this.onTouchStart,this),u.off(f.EventType.TOUCH_MOVE,this.onTouchMove,this),u.off(f.EventType.TOUCH_END,this.onTouchEnd,this),u.off(f.EventType.TOUCH_CANCEL,this.onTouchCancel,this),u.off(f.EventType.KEY_DOWN,this.onKeyDown,this),u.off(f.EventType.KEY_UP,this.onKeyUp,this)},h.start=function(){this.setOffset(this.clamp(this.scroll.startOffset,this.scroll.minOffset,this.scroll.maxOffset),!0),this.updateTopEdgeEntered(this._offset,!0)},h.update=function(t){if(!this._inputEnabled)return this.inertiaActive=!1,void(this.velocity=0);if(this.mouseHeld||this.mouseDragging||this.mouseActive||null!==this.touchId||this.touchDragging||this.touchActive)this.inertiaActive=!1;else{var e=0;if(this.keyHeldW&&(e-=this.scroll.keyAccel),this.keyHeldS&&(e+=this.scroll.keyAccel),0!==e){this.velocity+=e*t;var i=Math.min(this.scroll.keyMaxSpeed,this.scroll.maxInertiaSpeed);this.velocity=this.clamp(this.velocity,-i,i),this.inertiaActive=!0,this.events.emit("scroll-start")}if(this.inertiaActive||!(Math.abs(this.velocity)<this.scroll.stopVelocity)){var s=this._offset,n=this._offset+this.velocity*t;(n=this.clamp(n,this.scroll.minOffset,this.scroll.maxOffset))<=this.scroll.minOffset&&this.velocity<0&&(this.velocity=0),n>=this.scroll.maxOffset&&this.velocity>0&&(this.velocity=0);var o=Math.exp(-this.scroll.friction*t);this.velocity*=o,0===e&&Math.abs(this.velocity)<this.scroll.stopVelocity&&(this.velocity=0,this.inertiaActive&&(this.inertiaActive=!1,this.events.emit("scroll-end"))),n!==s&&this.setOffset(n,!0)}}},h.setOffset=function(t,e){void 0===e&&(e=!0);var i=this.clamp(t,this.scroll.minOffset,this.scroll.maxOffset);i!==this._offset&&(this._offset=i,this._suppressEdgeLogic||this.updateTopEdgeEntered(this._offset),e&&this.events.emit("offset-changed",this._offset))},h.updateTopEdgeEntered=function(t,e){var i=this;void 0===e&&(e=!1);var s,n=Math.min(this.scroll.topEnterOffset,this.scroll.topExitOffset),o=Math.max(this.scroll.topEnterOffset,this.scroll.topExitOffset);s=null===this.atTopEntered?t<=n:this.atTopEntered?t<=o:t<=n;var l=function(t){var e=t?"ENTERED":"EXITED";!function(t,e){void 0===e&&(e="*"),console.log(t);try{var i;null==(i=window.parent)||i.postMessage(t,e)}catch(t){}}({type:"TOP4_VISIBILITY",state:e});var s=i.top4Target;s&&("function"==typeof s.setVisibility?s.setVisibility(e):"ENTERED"===e&&"function"==typeof s.entered?s.entered():"EXITED"===e&&"function"==typeof s.exited&&s.exited())};if(null===this.atTopEntered)return this.atTopEntered=s,void(e&&l(s));s!==this.atTopEntered&&(this.atTopEntered=s,l(s))},h.setInputEnabled=function(t){this._inputEnabled!==t&&(this._inputEnabled=t,t||this.stopAll())},h.stopAll=function(){this.inertiaActive=!1,this.velocity=0,this.scrollTween&&(this.scrollTween.stop(),this.scrollTween=null),this._tweenDriver=null,this._pendingResolve&&(this._pendingResolve(),this._pendingResolve=null),this.mouseHeld=!1,this.mouseDragging=!1,this.mouseActive=!1,this.mouseClaimed=!1,this.touchId=null,this.touchDragging=!1,this.touchActive=!1,this.touchClaimed=!1,null==g.hardReset||g.hardReset()},h.scrollToHeight=function(t,e){var i=this;void 0===e&&(e={});var s=e,n=s.duration,o=void 0===n?0:n,l=s.easing,r=void 0===l?"quadOut":l,h=s.clamp,a=void 0===h||h;this.inertiaActive=!1,this.velocity=0,this.scrollTween&&(this.scrollTween.stop(),this.scrollTween=null);var c=a?this.clamp(t,this.scroll.minOffset,this.scroll.maxOffset):t;if(o<=0)return this._offset=c,this._suppressEdgeLogic||this.updateTopEdgeEntered(this._offset),this.events.emit("offset-changed",this._offset),void this.events.emit("scroll-end");var u="function"==typeof r?r:this._getEase(r);this._tweenDriver={value:this._offset},this.events.emit("scroll-start"),this.scrollTween=p(this._tweenDriver).to(o,{value:c},{progress:function(t,e,i,s){return t+(e-t)*u(Math.max(0,Math.min(1,s)))},onUpdate:function(){i._offset=a?i.clamp(i._tweenDriver.value,i.scroll.minOffset,i.scroll.maxOffset):i._tweenDriver.value,i._suppressEdgeLogic||i.updateTopEdgeEntered(i._offset),i.events.emit("offset-changed",i._offset)}}).call((function(){i.scrollTween=null,i._tweenDriver=null,i.events.emit("scroll-end")})).start()},h.scrollToHeightAsync=function(t,e){var i=this;return void 0===e&&(e={}),new Promise((function(s){i._pendingResolve&&(i._pendingResolve(),i._pendingResolve=null);var n=e,o=n.duration,l=void 0===o?0:o,r=n.easing,h=void 0===r?"quadOut":r,a=n.clamp,c=void 0===a||a;i.inertiaActive=!1,i.velocity=0,i.scrollTween&&(i.scrollTween.stop(),i.scrollTween=null);var u=c?i.clamp(t,i.scroll.minOffset,i.scroll.maxOffset):t;if(l<=0)return i._offset=u,i.updateTopEdgeEntered(i._offset),i.events.emit("offset-changed",i._offset),i.events.emit("scroll-end"),void s();var f="function"==typeof h?h:i._getEase(h);i._tweenDriver={value:i._offset},i.events.emit("scroll-start"),i._pendingResolve=s,i.scrollTween=p(i._tweenDriver).to(l,{value:u},{progress:function(t,e,i,s){return t+(e-t)*f(Math.max(0,Math.min(1,s)))},onUpdate:function(){i._offset=c?i.clamp(i._tweenDriver.value,i.scroll.minOffset,i.scroll.maxOffset):i._tweenDriver.value,i.updateTopEdgeEntered(i._offset),i.events.emit("offset-changed",i._offset)}}).call((function(){i.scrollTween=null,i._tweenDriver=null,i.events.emit("scroll-end");var t=i._pendingResolve;i._pendingResolve=null,null==t||t()})).start()}))},h.scrollToHeightWithNudgeAsync=function(){var t=l(r().mark((function t(e,i,s,n,o){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===i&&(i=.35),void 0===s&&(s=.1),void 0===n&&(n="quadOut"),void 0===o&&(o=!0),t.next=6,this.scrollToHeightAsync(e,{duration:i,easing:n,clamp:o});case 6:if(!(s>.01)){t.next=9;break}return t.next=9,this.scrollToHeightAsync(e,{duration:s,easing:n,clamp:o});case 9:case"end":return t.stop()}}),t,this)})));return function(e,i,s,n,o){return t.apply(this,arguments)}}(),h.scrollByHeight=function(t,e){void 0===e&&(e={}),this.scrollToHeight(this._offset+t,e)},h.scrollByHeightAsync=function(t,e){return void 0===e&&(e={}),this.scrollToHeightAsync(this._offset+t,e)},h.stopScrollTween=function(){this.scrollTween&&(this.scrollTween.stop(),this.scrollTween=null),this._pendingResolve&&(this._pendingResolve(),this._pendingResolve=null),this._tweenDriver=null,this.events.emit("scroll-end")},h.onMouseDown=function(t){if(this._inputEnabled&&0===t.getButton()&&(!g.inGesture||"mouse"!==g.source)){this.mouseHeld=!0;var e=t.getLocationY();this.mouseStartY=e,this.mouseLastY=e,this.mouseDragging=!1,this.mouseActive=!1,this.mouseClaimed=!1,this.inertiaActive=!1,this.velocity=0,this.moveSamples.length=0,this.pushSample(e)}},h.onMouseMove=function(t){if(this._inputEnabled&&this.mouseHeld&&null!==this.mouseLastY&&null!==this.mouseStartY){var e=t.getLocationY(),i=e-this.mouseLastY,s=e-this.mouseStartY;if(this.mouseLastY=e,this.pushSample(e),!this.mouseDragging){if(!(Math.abs(s)>=this.scroll.dragThreshold))return;this.mouseDragging=!0}if(0!==i){if(!this.mouseActive){if(this.mouseActive=!0,g.inGesture)return;g.beginGesture(bt,"mouse"),this.mouseClaimed=!0,this.events.emit("scroll-start"),g.markDrag(bt)}this.mouseClaimed&&this.applyDeltaUnits(i*this.scroll.unitsPerPixel)}}},h.onMouseUp=function(t){this._inputEnabled&&0===t.getButton()&&(this.mouseClaimed&&g.tryEndGesture(bt,"mouse"),this.mouseHeld=!1,this.mouseStartY=this.mouseLastY=null,this.mouseDragging=!1,this.mouseActive=!1,this.mouseClaimed=!1,this.moveSamples.length>=2?this.startInertiaFromSamples():this.events.emit("scroll-end"))},h.onWheel=function(t){if(this._inputEnabled){var e=-t.getScrollY();if(0!==e){var i=e/120*this.scroll.unitsPerWheelTick,s=this.nowMs();s-this.wheelDeadzoneLastTs>this.scroll.wheelDeadzoneResetMs&&(this.wheelAccumUnits=0),this.wheelDeadzoneLastTs=s,this.wheelAccumUnits+=i;var n=Math.abs(this.wheelAccumUnits),o=Math.max(0,this.scroll.wheelDeadzoneUnits);if(!(n<o)){var l=this.wheelAccumUnits-Math.sign(this.wheelAccumUnits)*o;this.wheelAccumUnits=0;var r=this.clamp(l*this.scroll.wheelKick,-this.scroll.maxInertiaSpeed,this.scroll.maxInertiaSpeed);this.velocity=this.clamp(this.velocity+r,-this.scroll.maxInertiaSpeed,this.scroll.maxInertiaSpeed),this.inertiaActive=Math.abs(this.velocity)>=this.scroll.stopVelocity,this.events.emit("scroll-start")}}}},h.onTouchStart=function(t){if(this._inputEnabled&&(!g.inGesture||"touch"!==g.source)&&null===this.touchId){var e=t.getID();this.touchId=e;var i=t.getLocationY();this.touchStartY=i,this.touchLastY=i,this.touchDragging=!1,this.touchActive=!1,this.touchClaimed=!1,this.inertiaActive=!1,this.velocity=0,this.moveSamples.length=0,this.pushSample(i)}},h.onTouchMove=function(t){if(this._inputEnabled){var e=t.getID();if(this.touchId===e&&null!==this.touchLastY&&null!==this.touchStartY&&(!g.inGesture||"touch"!==g.source||this.touchClaimed)){var i=t.getLocationY(),s=i-this.touchLastY,n=i-this.touchStartY;if(this.touchLastY=i,this.pushSample(i),!this.touchDragging){if(!(Math.abs(n)>=this.scroll.dragThreshold))return;this.touchDragging=!0}if(0!==s){if(!this.touchActive){if(g.inGesture)return;this.touchActive=!0,g.beginGesture(e,"touch"),this.touchClaimed=!0,this.events.emit("scroll-start"),g.markDrag(e)}this.touchClaimed&&this.applyDeltaUnits(s*this.scroll.unitsPerPixel)}}}},h.onTouchEnd=function(t){if(this._inputEnabled){var e=t.getID();this.touchId===e&&(this.touchClaimed&&g.tryEndGesture(e,"touch"),this.touchId=null,this.touchStartY=this.touchLastY=null,this.touchDragging=!1,this.touchActive=!1,this.touchClaimed=!1,this.moveSamples.length>=2?this.startInertiaFromSamples():this.events.emit("scroll-end"))}},h.onTouchCancel=function(t){if(this._inputEnabled){var e=t.getID();this.touchId===e&&(this.touchClaimed&&g.tryEndGesture(e,"touch"),this.touchId=null,this.touchStartY=this.touchLastY=null,this.touchDragging=!1,this.touchActive=!1,this.touchClaimed=!1,this.moveSamples.length>=2?this.startInertiaFromSamples():this.events.emit("scroll-end"))}},h.nowMs=function(){var t,e;return null!=(t=null==(e=globalThis.performance)||null==e.now?void 0:e.now())?t:Date.now()},h.pushSample=function(t){var e=this.nowMs();this.moveSamples.push({t:e,y:t}),this.moveSamples.length>this.maxSamples&&this.moveSamples.shift();for(var i=this.moveSamples[this.moveSamples.length-1];this.moveSamples.length>1&&i.t-this.moveSamples[0].t>200;)this.moveSamples.shift()},h.startInertiaFromSamples=function(){if(!this.scroll.enableInertia)return this.moveSamples.length=0,void this.events.emit("scroll-end");if(this.moveSamples.length>=2){var t=this.moveSamples[0],e=this.moveSamples[this.moveSamples.length-1],i=Math.max(.001,(e.t-t.t)/1e3),s=(e.y-t.y)/i*this.scroll.unitsPerPixel;this.velocity=this.clamp(s,-this.scroll.maxInertiaSpeed,this.scroll.maxInertiaSpeed),this.inertiaActive=Math.abs(this.velocity)>=this.scroll.stopVelocity,this.inertiaActive||this.events.emit("scroll-end")}this.moveSamples.length=0},h.applyDeltaUnits=function(t){var e=this._offset,i=this.clamp(e+t,this.scroll.minOffset,this.scroll.maxOffset);i!==e&&this.setOffset(i,!0)},h.clamp=function(t,e,i){return Math.min(i,Math.max(e,t))},h._getEase=function(t){switch(t){case"linear":return function(t){return t};case"quadIn":return function(t){return t*t};case"quadOut":return function(t){return 1-(1-t)*(1-t)};case"quadInOut":return function(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2};case"cubicIn":return function(t){return t*t*t};case"cubicOut":return function(t){return 1-Math.pow(1-t,3)};case"cubicInOut":return function(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2};case"quartIn":return function(t){return t*t*t*t};case"quartOut":return function(t){return 1-Math.pow(1-t,4)};case"quartInOut":return function(t){return t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2};default:return function(t){return 1-(1-t)*(1-t)}}},h.pushUnclamped=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=1e15),this._limitsStack.push({min:this.scroll.minOffset,max:this.scroll.maxOffset,topEnter:this.scroll.topEnterOffset,topExit:this.scroll.topExitOffset}),this.scroll.minOffsetPC=this.scroll.minOffsetMobile=-e,this.scroll.maxOffset=e,this._suppressEdgeLogic=t},h.popUnclamped=function(){var t=this._limitsStack.pop();t?(this.scroll.minOffsetPC=this.scroll.minOffsetMobile=t.min,this.scroll.maxOffset=t.max,this.scroll.topEnterOffsetPC=t.topEnter,this.scroll.topEnterOffsetMobile=t.topEnter,this.scroll.topExitOffsetPC=t.topExit,this.scroll.topExitOffsetMobile=t.topExit,this._suppressEdgeLogic=!1):this._suppressEdgeLogic=!1},h.onKeyDown=function(t){var e,i;if(this._inputEnabled)switch(null==(e=t.event)||null==(e=e.preventDefault)||null==(i=e.bind(t.event))||i(),t.keyCode){case m.KEY_W:case m.ARROW_UP:this.keyHeldW=!0;break;case m.KEY_S:case m.ARROW_DOWN:this.keyHeldS=!0}},h.onKeyUp=function(t){var e,i;if(this._inputEnabled)switch(null==(e=t.event)||null==(e=e.preventDefault)||null==(i=e.bind(t.event))||i(),t.keyCode){case m.KEY_W:case m.ARROW_UP:this.keyHeldW=!1;break;case m.KEY_S:case m.ARROW_DOWN:this.keyHeldS=!1}},i(e,[{key:"offset",get:function(){return this._offset}},{key:"inputEnabled",get:function(){return this._inputEnabled}},{key:"isBusy",get:function(){return!!this.scrollTween||this.inertiaActive||Math.abs(this.velocity)>this.scroll.stopVelocity}}]),e}(v)).prototype,"scroll",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Tt}}),gt=e(vt.prototype,"top4Target",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mt=vt))||mt));h._RF.pop()}}}));

System.register("chunks:///_virtual/TVS_SpawnLayout.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ClickMoveBinding.ts","./ColorLibrary.ts","./TowerScrollController.ts"],(function(e){var t,i,n,r,l,a,o,s,u,c,h,p,f,d,v,g,b,m,y,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty,n=e.inheritsLoose,r=e.assertThisInitialized,l=e.createForOfIteratorHelperLoose,a=e.createClass,o=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){u=e.cclegacy,c=e._decorator,h=e.Prefab,p=e.Label,f=e.sys,d=e.instantiate,v=e.MeshRenderer,g=e.assetManager,b=e.Component},function(e){m=e.ClickMoveBinding},function(e){y=e.ColorTextureLibrary},function(e){w=e.TowerScrollController}],execute:function(){var S,x,P,L,T,M,C,k,I,_,A,F,N,z,B,O,D,R,Y,H,V,E,U,j,q,W,G,X,$,J,Z,K,Q,ee,te,ie,ne,re,le,ae,oe,se,ue,ce,he,pe,fe,de,ve,ge,be,me,ye,we,Se,xe,Pe,Le,Te,Me,Ce,ke,Ie,_e,Ae,Fe,Ne,ze,Be,Oe,De,Re;u._RF.push({},"368ffNUv4lFSZtXbbDm9TB3","TVS_SpawnLayout",void 0);var Ye=c.ccclass,He=c.property,Ve=e("TVS_SpawnLayout",(S=Ye("TVS_SpawnLayout"),x=He({type:h}),P=He({tooltip:"Базовый масштаб префаба (Node.scale = 1 → это baseScale префаба)"}),L=He({tooltip:"Базовая геом. высота куска (до масштабов префаба и Node.scale)"}),T=He({tooltip:"Целевой экранный масштаб «базового» куска"}),M=He({tooltip:"Визуальный зазор между уровнями (в ед.: baseHeight * Node.scale)"}),C=He({tooltip:"Якорь Y (локально) — центр окна"}),k=He({tooltip:"Интенсивность градиента масштаба (0..1)"}),I=He({tooltip:"Коэф. по слоям r: r<1 — вниз мельче; r>1 — вниз крупнее."}),_=He({tooltip:"Включить кламп масштаба каждого куска"}),A=He({tooltip:"Минимальный Node.scale"}),F=He({tooltip:"Максимальный Node.scale"}),N=He({tooltip:"Индекс материала внутри MeshRenderer"}),z=He({tooltip:"Фолбэк: число наборов в библиотеке, если она сама не сообщает"}),B=He({type:p,tooltip:"Куда выводить глобальный счётчик пройденных кусочков"}),O=He({tooltip:"Сколько всего кусочков хотим показать"}),D=He({tooltip:"Seed для выборки/перемешивания кусков"}),R=He({tooltip:"Случайный «набор» (цвета/текстуры) на кусок по gidx"}),Y=He({tooltip:"Seed для вычисления индекса набора из gidx"}),H=He({tooltip:"Доп. уровни прокрутки ПОСЛЕ последнего уровня"}),V=He({tooltip:"Если true — последний неполный уровень прижат к верху окна"}),E=He({tooltip:"Делать неполный уровень в НАЧАЛЕ башни (сверху)"}),U=He({tooltip:"Автоматически подставлять значения для ПК/Телефон (по sys.isMobile)"}),j=He({tooltip:"ПК: сколько видимых уровней"}),q=He({tooltip:"ПК: anchorY"}),W=He({tooltip:"Телефон: сколько видимых уровней"}),G=He({tooltip:"Телефон: anchorY"}),X=He({tooltip:"Разрешать ли спавн фейковых тортов (если не хватает API)"}),S((Z=t((J=function(){i(this,"prefab",Z,this),i(this,"objectsPerLevel",K,this),i(this,"visibleLevels",Q,this),i(this,"angleStep",ee,this),i(this,"baseScale",te,this),i(this,"baseHeight",ie,this),i(this,"targetVisualScale",ne,this),i(this,"levelPaddingVisual",re,this),i(this,"anchorY",le,this),i(this,"scaleInWindow",ae,this),i(this,"r",oe,this),i(this,"enableScaleClamp",se,this),i(this,"minScale",ue,this),i(this,"maxScale",ce,this),i(this,"materialIndex",he,this),i(this,"colorSetsFallback",pe,this),i(this,"counterLabel",fe,this),i(this,"targetPieces",de,this),i(this,"rngSeed",ve,this),i(this,"randomizeColors",ge,this),i(this,"rngSeedColors",be,this),i(this,"padAfterLevels",me,this),i(this,"endPartialAtTop",ye,this),i(this,"partialAtTop",we,this),i(this,"autoDeviceParams",Se,this),i(this,"visibleLevelsDesktop",xe,this),i(this,"anchorYDesktop",Pe,this),i(this,"visibleLevelsMobile",Le,this),i(this,"anchorYMobile",Te,this),i(this,"allowFakePieces",Me,this)}).prototype,"prefab",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=t(J.prototype,"objectsPerLevel",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 8}}),Q=t(J.prototype,"visibleLevels",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),ee=t(J.prototype,"angleStep",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),te=t(J.prototype,"baseScale",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ie=t(J.prototype,"baseHeight",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),ne=t(J.prototype,"targetVisualScale",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.6}}),re=t(J.prototype,"levelPaddingVisual",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),le=t(J.prototype,"anchorY",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ae=t(J.prototype,"scaleInWindow",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),oe=t(J.prototype,"r",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.9}}),se=t(J.prototype,"enableScaleClamp",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ue=t(J.prototype,"minScale",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.4}}),ce=t(J.prototype,"maxScale",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.8}}),he=t(J.prototype,"materialIndex",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pe=t(J.prototype,"colorSetsFallback",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 256}}),fe=t(J.prototype,"counterLabel",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),de=t(J.prototype,"targetPieces",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),ve=t(J.prototype,"rngSeed",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 123456789}}),ge=t(J.prototype,"randomizeColors",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),be=t(J.prototype,"rngSeedColors",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 987654321}}),me=t(J.prototype,"padAfterLevels",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),ye=t(J.prototype,"endPartialAtTop",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),we=t(J.prototype,"partialAtTop",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Se=t(J.prototype,"autoDeviceParams",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xe=t(J.prototype,"visibleLevelsDesktop",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Pe=t(J.prototype,"anchorYDesktop",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Le=t(J.prototype,"visibleLevelsMobile",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6}}),Te=t(J.prototype,"anchorYMobile",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Me=t(J.prototype,"allowFakePieces",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$=J))||$));e("TowerLayoutController",(Ce=Ye("TowerLayoutController"),ke=He({type:Ve}),Ie=He({type:w,tooltip:"Ссылка на контроллер скролла"}),_e=He({type:[String]}),Ae=He({tooltip:"Сколько реальных картинок (GPU upload) можно ставить за кадр"}),Ce(((Re=function(e){function t(){for(var t,n=arguments.length,l=new Array(n),a=0;a<n;a++)l[a]=arguments[a];return t=e.call.apply(e,[this].concat(l))||this,i(t,"spawn",ze,r(t)),i(t,"scrollCtrl",Be,r(t)),i(t,"Falenames",Oe,r(t)),i(t,"imagesPerFrame",De,r(t)),t._imagesBudget=0,t.pool=[],t.nodeLevelInfo=new Map,t.passedPieces=0,t.cakesSource=[],t.cakesExpanded=[],t._sentReady=!1,t.realPiecesCount=0,t.prevTopBase=-1,t.onOffsetChanged=function(e){var i,n=t.getMaxScrollableOffset(),r=Math.min(e,n);r!==e&&(null==(i=t.scrollCtrl)||i.scrollToHeight(r,{duration:0})),t.layoutByOffset(r)},t}n(t,e);var u=t.prototype;return u.isMobileLike=function(){return!!f.isMobile},u.notifyCakeLoaded=function(){if(!this._sentReady){this._sentReady=!0;var e={type:"IFRAME_READY",totalPieces:this.getTotalPieces()};this.safePostToParent(e)}},u.safePostToParent=function(e,t){void 0===t&&(t="*"),console.log(e);try{var i;null==(i=window.parent)||i.postMessage(e,t)}catch(e){}},u.applyDeviceParamsAndRelayout=function(e){var t;if(void 0===e&&(e=!1),null!=(t=this.spawn)&&t.autoDeviceParams||e){var i=this.isMobileLike(),n=Math.max(1,0|(i?this.spawn.visibleLevelsMobile:this.spawn.visibleLevelsDesktop)),r=i?this.spawn.anchorYMobile:this.spawn.anchorYDesktop,l=!1;this.spawn.visibleLevels!==n&&(this.spawn.visibleLevels=n,l=!0),this.spawn.anchorY!==r&&(this.spawn.anchorY=r,l=!0),l&&(this.buildPool(),this.forceRebindVisibleNow())}},u.onLoad=function(){this.lib||console.warn("[TowerLayoutController] ColorTextureLibrary.instance не найден — добавьте компонент на сцену."),this.applyDeviceParamsAndRelayout(!0)},u.boolFromYesNo=function(e){if("string"==typeof e){var t=e.trim().toLowerCase();if("yes"===t)return!0;if("no"===t)return!1}return"boolean"==typeof e?e:null},u.onEnable=function(){var e=o(s().mark((function e(){var t,i,n,r,l,a,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.applyDeviceParamsAndRelayout(!0),this.buildPool(),this.prevTopBase=-1,this.layoutByOffset(null!=(t=null==(i=this.scrollCtrl)?void 0:i.offset)?t:0),e.next=6,this.initApiData();case 6:return this.rebuildExpandedCakes(),this.forceRebindVisibleNow(),this.primeVisibleTextsNow(),a=null!=(n=null==(r=this.scrollCtrl)?void 0:r.offset)?n:0,o=this.getMaxScrollableOffset(),u=Math.min(a,o),this.scrollCtrl&&u!==a&&this.scrollCtrl.scrollToHeight(u,{duration:0}),this.layoutByOffset(u),e.next=16,this.waitUntilFirstLevelImagesLoaded();case 16:this.forceApplyMediaForLevel0(),this.notifyCakeLoaded(),null==(l=this.scrollCtrl)||l.events.on("offset-changed",this.onOffsetChanged,this);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),u.onDisable=function(){var e;null==(e=this.scrollCtrl)||e.events.off("offset-changed",this.onOffsetChanged,this)},u.getLevelStep=function(){return Math.max(1e-6,this.levelStep)},u.getObjectsPerLevel=function(){return this.per},u.getPiecesCount=function(){return this.getTotalPieces()},u.findMappedAncestor=function(e){for(var t=e;t;t=t.parent)if(this.nodeLevelInfo.has(t))return t;return null},u.getNodeLevel=function(e){var t,i;return null!=(t=null==(i=this.nodeLevelInfo.get(e))?void 0:i.level)?t:null},u.getLevelForAny=function(e){var t,i,n=this.findMappedAncestor(e);return n&&null!=(t=null==(i=this.nodeLevelInfo.get(n))?void 0:i.level)?t:null},u.getSlotForAny=function(e){var t,i,n=this.findMappedAncestor(e);return n&&null!=(t=null==(i=this.nodeLevelInfo.get(n))?void 0:i.slot)?t:null},u.findNodeByLevelSlot=function(e,t){for(var i,n=l(this.nodeLevelInfo);!(i=n()).done;){var r=i.value,a=r[0],o=r[1];if(a.activeInHierarchy&&o.level===e&&o.slot===t)return a}return null},u.scrollToLevel=function(e,t){var i;null==(i=this.scrollCtrl)||i.scrollToHeight(e*this.levelStep,null!=t?t:{})},u.scrollToNodeLevel=function(e,t){var i=this.getNodeLevel(e);return null!=i&&(this.scrollToLevel(i,t),!0)},u.scrollToNodeOrAncestorLevel=function(e,t){var i=this.findMappedAncestor(e);return!!i&&this.scrollToNodeLevel(i,t)},u.dataIndexToLevelSlot=function(e){var t=this.getTotalPieces();if(e<0||e>=t)return null;var i=this.per,n=e+this.getHeadPad(i,t);return{level:Math.floor(n/i),slot:n%i}},u.levelSlotToDataIndex=function(e,t){var i=this.getTotalPieces(),n=this.per,r=e*n+t-this.getHeadPad(n,i);return r>=0&&r<i?r:-1},u.getPieceByDataIndex=function(e){var t=this.dataIndexToLevelSlot(e);return t?this.getPieceFor(t.level,t.slot):null},u.findLevelSlotByUniqId=function(e){if(!e)return null;for(var t=this.getTotalPieces(),i=0;i<t;i++){var n=this.cakesExpanded[i];if(null!=n&&n.uniq_id&&n.uniq_id.toLowerCase()===e.toLowerCase()){var r=this.dataIndexToLevelSlot(i);if(!r)continue;return{level:r.level,slot:r.slot,dataIndex:i,piece:n}}}return null},u.scrollToUniqId=function(e,t){var i=this.findLevelSlotByUniqId(e);return!!i&&(this.scrollToLevel(i.level,t),!0)},u.getPieceInfoByLevelSlot=function(e,t){var i=this.levelSlotToDataIndex(e,t);if(i<0)return null;var n=this.getPieceFor(e,t);return n?{level:e,slot:t,dataIndex:i,piece:n}:null},u.scrollToRandomPiece=function(e){var t,i=this.getTotalPieces();if(!i)return null;var n=this.mulberry32((null!=(t=null==e?void 0:e.seed)?t:this.spawn.rngSeed)>>>0),r=Math.floor(n()*i),l=this.dataIndexToLevelSlot(r);if(!l)return null;this.scrollToLevel(l.level,e);var a=this.getPieceFor(l.level,l.slot);return a?{level:l.level,slot:l.slot,dataIndex:r,piece:a}:null},u.initApiData=function(){var e=o(s().mark((function e(){var t,i,n,r,l,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=window.location.hostname.replace(/^([^.]+)/,"api"),i=Date.now(),e.next=5,fetch("https://"+t+"/storage/app/public/shared-cakes/cake-list.json?ts="+i,{headers:{Accept:"application/json"},cache:"no-store"});case 5:if((n=e.sent).ok){e.next=15;break}return e.t0=console,e.t1=n.status,e.next=11,this.safeReadText(n);case 11:return e.t2=e.sent,e.t0.error.call(e.t0,"[API] Ошибка:",e.t1,e.t2),this.cakesSource=[],e.abrupt("return");case 15:return e.next=17,n.json();case 17:r=e.sent,l=Array.isArray(r)?r:Array.isArray(null==r?void 0:r.cakes)?r.cakes:[],this.cakesSource=l.map((function(e){return a.normalizeCakePiece(e)})),console.log("[API] Загружено кусков:",this.cakesSource.length,this.cakesSource),e.next=27;break;case 23:e.prev=23,e.t3=e.catch(0),console.error("[API] Ошибка соединения:",e.t3),this.cakesSource=[];case 27:case"end":return e.stop()}}),e,this,[[0,23]])})));return function(){return e.apply(this,arguments)}}(),u.initApiData2=function(){var e=o(s().mark((function e(){var t,i,n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://api.demo-stage.ru/cake/list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});case 3:if((t=e.sent).ok){e.next=13;break}return e.t0=console,e.t1=t.status,e.next=9,this.safeReadText(t);case 9:return e.t2=e.sent,e.t0.error.call(e.t0,"[API] Ошибка:",e.t1,e.t2),this.cakesSource=[],e.abrupt("return");case 13:return e.next=15,t.json();case 15:i=e.sent,n=Array.isArray(null==i?void 0:i.cakes)?i.cakes:[],this.cakesSource=n.map((function(e){return r.normalizeCakePiece(e)})),console.log(this.cakesSource),e.next=25;break;case 21:e.prev=21,e.t3=e.catch(0),console.error("[API] Ошибка соединения:",e.t3),this.cakesSource=[];case 25:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(){return e.apply(this,arguments)}}(),u.rebuildExpandedCakes=function(){var e=this.cakesSource.filter(Boolean),t=Math.max(0,Math.floor(this.spawn.targetPieces)),i=!this.spawn.allowFakePieces,n=i?Math.min(t,e.length):t,r=[],l=Math.min(n,e.length);if(r.push.apply(r,e.slice(0,l)),!i&&r.length<n)for(var a=r.length;a<n;a++)r.push(this.makeFakePiece(a));this.cakesExpanded=r,this.realPiecesCount=r.filter((function(e){return!e.__fake})).length,this.dlog("[EXPAND]","targetPieces="+t+", allowFake="+!i+", API="+e.length+", взятоИзAPI="+l+", фейковДобавлено="+(r.length-l)+", итогВсего="+r.length+", реальныхВИтоге="+this.realPiecesCount)},u.makeFakePiece=function(e){var t={uniq_id:null,hex_color:null,name:this.makeFakeText(e).name,filling_id:null,file:null,greeting_text:null,show_name:!0,__fake:!0};return t},u.getHeadPad=function(e,t){if(!this.spawn.partialAtTop||e<=0||t<=0)return 0;var i=t%e;return 0===i?0:e-i},u.getTotalPieces=function(){return 0|this.cakesExpanded.length},u.getTotalLevels=function(){var e=this.getTotalPieces(),t=this.getHeadPad(this.per,e);return Math.ceil((t+e)/this.per)},u.getPieceFor=function(e,t){var i=this.getTotalPieces();if(!i)return null;var n=this.getHeadPad(this.per,i),r=e*this.per+t-n;return r>=0&&r<i?this.cakesExpanded[r]:null},u.globalIndexOf=function(e,t){return e*this.per+t},u.layoutByOffset=function(e){var i=this;if(this.spawn.prefab&&this.pool.length){var n=e/Math.max(1e-6,this.levelStep),r=this.getTotalLevels(),l=r>0,a=Math.max(0,this.spawn.padAfterLevels),o=Math.max(0,r-this.vis+a),s=l?Math.min(n,o):n,u=Math.max(0,Math.floor(s)),c=s-u,h=u*this.per;if(h!==this.passedPieces&&(this.passedPieces=h,this.spawn.counterLabel&&(this.spawn.counterLabel.string=String(this.passedPieces))),this.prevTopBase<0){for(var p=0;p<this.vis;p++)for(var f=u+p,d=0;d<this.per;d++){var v=this.pool[p*this.per+d];this.bindNodeFor(f,d,v)}this.prevTopBase=u}else if(u!==this.prevTopBase){var g=u-this.prevTopBase;if(g>0)for(var b=0;b<g;b++){var m,y=this.pool.splice(0,this.per);(m=this.pool).push.apply(m,y);for(var w=this.prevTopBase+this.vis+b,S=0;S<this.per;S++){var x=this.pool[(this.vis-1)*this.per+S];this.bindNodeFor(w,S,x)}}else for(var P=0;P<-g;P++){var L,T=this.pool.splice(this.pool.length-this.per,this.per);(L=this.pool).unshift.apply(L,T);for(var M=this.prevTopBase-1-P,C=0;C<this.per;C++){var k=this.pool[C];this.bindNodeFor(M,C,k)}}this.prevTopBase=u}for(var I=this.spawn.scaleInWindow,_=Math.max(1e-6,this.spawn.r),A=function(e){return function(e){if(!i.spawn.enableScaleClamp)return e;var t=Math.min(i.spawn.minScale,i.spawn.maxScale),n=Math.max(i.spawn.minScale,i.spawn.maxScale);return Math.min(n,Math.max(t,e))}(i.basePieceScale*Math.pow(_,-e*I))},F=A(u-s),N=-c*(this.spawn.baseHeight*this.spawn.baseScale*F+this.spawn.levelPaddingVisual),z=this.spawn.angleStep,B=0;B<this.vis;B++){for(var O=u+B,D=A(O-s),R=this.spawn.anchorY-N,Y=0;Y<this.per;Y++){var H=this.pool[B*this.per+Y],V=this._getNodeCache(H);V.slot===Y&&V.angleStep===z||(H.setRotationFromEuler(0,Y*z,0),V.slot=Y,V.angleStep=z),(void 0===V.lastY||Math.abs(V.lastY-R)>t.EPS)&&(H.setPosition(0,R,0),V.lastY=R),(void 0===V.lastScale||Math.abs(V.lastScale-D)>t.EPS)&&(H.setScale(D,D,D),V.lastScale=D),this.nodeLevelInfo.has(H)&&this.nodeLevelInfo.get(H).level===O&&this.nodeLevelInfo.get(H).slot===Y||(this.nodeLevelInfo.set(H,{level:O,slot:Y}),V.level=O)}N+=this.spawn.baseHeight*this.spawn.baseScale*D+this.spawn.levelPaddingVisual}}},u.bindNodeFor=function(e,t,i){var n=this.getPieceFor(e,t);if(!n)return i.active=!1,this.nodeLevelInfo.delete(i),void(i.__boundIndex=void 0);i.active||(i.active=!0);var r=this.globalIndexOf(e,t);this.applyLibrarySetForIndex(i,r,n),this.applyPieceTextFromApi(i,n,r);var l=!1;this.shouldLoadApiImage(e)&&this._imagesBudget>0&&(l=!0,this._imagesBudget--),this.applySideImageOrPlaceholder(i,n,r,l),i.__boundIndex=r,this.nodeLevelInfo.set(i,{level:e,slot:t})},u.primeVisibleTextsNow=function(){var e,t;if(this.pool.length){for(var i=null!=(e=null==(t=this.scrollCtrl)?void 0:t.offset)?e:0,n=i/Math.max(1e-6,this.levelStep),r=Math.max(0,Math.floor(n)),l=0;l<this.vis;l++)for(var a=r+l,o=0;o<this.per;o++){var s=this.pool[l*this.per+o],u=this.getPieceFor(a,o);if(s&&u){var c=this.globalIndexOf(a,o);this.applyLibrarySetForIndex(s,c,u),this.applyPieceTextFromApi(s,u,c);var h=!1;this.shouldLoadApiImage(a)&&this._imagesBudget>0&&(h=!0,this._imagesBudget--),this.applySideImageOrPlaceholder(s,u,c,h),this.nodeLevelInfo.set(s,{level:a,slot:o}),s.__boundIndex=c}}this.prevTopBase=r,this.layoutByOffset(i)}},u._getNodeCache=function(e){var t;return null!=(t=e.__cache)?t:e.__cache={bindings:null,mrs:null,lastBaseSet:-1,lastSetCount:-1,lastGidx:-1,lastScale:void 0,lastY:void 0,slot:void 0,angleStep:void 0,level:void 0,lastName:void 0}},u.applyLibrarySetForIndex=function(e,t,i){var n,r=this.lib;if(r){var a=this._getNodeCache(e);a.bindings||(a.bindings=e.getComponentsInChildren(m));var o=a.bindings;if(r.resolveTheme(null!=(n=null==i?void 0:i.hex_color)?n:null,this.spawn.rngSeedColors>>>0,t))for(var s,u=l(o);!(s=u()).done;){var c,h,p=s.value;r.applyThemeToBinding(p,null!=(c=null==i?void 0:i.hex_color)?c:null,t,this.spawn.rngSeedColors>>>0,null!=(h=null==i?void 0:i.filling_id)?h:null,this.spawn.rngSeedColors>>>0)}}},u.shouldLoadApiImage=function(e){return 0===e},u.update=function(){this._imagesBudget=Math.max(0,0|this.imagesPerFrame)},u.makeFakeText=function(e){var t=this.mulberry32((this.spawn.rngSeedColors^2654435761*e)>>>0);return{name:this.Falenames[Math.floor(t()*this.Falenames.length)]}},u.safeReadText=function(){var e=o(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.text();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return","");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),u.strOrNull=function(e){if("string"!=typeof e)return null;var t=e.trim();return t||null},u.numOrNull=function(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e){var t=e.trim();if(!t)return null;var i=Number(t);return Number.isFinite(i)?i:null}return null},u.shouldActivateMedia=function(e){return 0===e},u.dlog=function(){for(var e,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];(e=console).log.apply(e,["[TowerLayoutController]"].concat(i))},u.isUuidLoose=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.trim())},u.normalizeCakePiece=function(e){var t,i,n,r,l,a,o,s,u,c,h,p,f=this.anyToStringOrNull(null!=(t=null!=(i=null!=(n=null==e?void 0:e.uniq_id)?n:null==e?void 0:e.id)?i:null==e?void 0:e.user_id)?t:null==e?void 0:e.uniqId),d=this.strOrNull(null!=(r=null==e?void 0:e.hex_color)?r:null==e?void 0:e.color);if(d){var v=d.trim();if(v.startsWith("#")&&(v=v.slice(1)),3===(v=v.toLowerCase()).length){var g=v[0],b=v[1],m=v[2];d=("#"+g+g+b+b+m+m).toUpperCase()}else d=6===v.length&&/^[0-9a-f]{6}$/.test(v)?("#"+v).toUpperCase():null}return{uniq_id:f,hex_color:d,name:this.strOrNull(null==e?void 0:e.name),filling_id:this.numOrNull(null!=(l=null==e?void 0:e.filling_id)?l:null==e?void 0:e.fillingId),file:"https://api.cakeproject28.ru"+this.strOrNull(null!=(a=null!=(o=null!=(s=null==e?void 0:e.file)?s:null==e?void 0:e.file_url)?o:null==e?void 0:e.fileUrl)?a:null==e?void 0:e.file_base64),greeting_text:this.strOrNull(null!=(u=null!=(c=null==e?void 0:e.greeting_text)?c:null==e?void 0:e.greetingText)?u:null==e?void 0:e.greeting),show_name:null==(h=this.boolFromYesNo(null!=(p=null==e?void 0:e.show_name)?p:null==e?void 0:e.showName))||h}},u.getMaxScrollableOffset=function(){var e=this.getTotalLevels();if(0===e)return 0;var t=Math.max(0,this.spawn.padAfterLevels);return(Math.max(0,e-this.vis+t)+1)*this.levelStep},u.buildPool=function(){var e=this.vis*this.per;if(this.spawn.prefab){this.pool.length=0;for(var t=0;t<e;t++){var i=d(this.spawn.prefab);i.setParent(this.node),i.active=!0;try{for(var n,r=i.getComponentsInChildren(v),a=l(r);!(n=a()).done;){var o=n.value,s=this.lib;s?(o.getMaterialInstance(s.patternMatIndex),o.getMaterialInstance(s.sideMatIndex)):o.getMaterialInstance(0)}}catch(e){}this.pool.push(i)}this.nodeLevelInfo.clear()}else console.warn("TowerLayoutController: prefab не назначен")},u.forceRebindVisibleNow=function(){var e,t,i=null!=(e=null==(t=this.scrollCtrl)?void 0:t.offset)?e:0;this.prevTopBase=-1,this.layoutByOffset(i)},u.preloadTexture=function(e){return new Promise((function(t,i){g.loadRemote(e,(function(e){e?i(e):t()}))}))},u.ensureBottomPaddingForHeight=function(e,t){void 0===t&&(t=0);var i=this.getLevelStep();if(!(i<=0)){var n=e/i,r=this.getTotalLevels();if(!(r<=0)){var l=Math.max(0,Math.ceil(n)),a=Math.max(0,r-this.vis),o=Math.max(0,l+Math.max(0,t)-a);if(o>this.spawn.padAfterLevels){var s,u,c,h;this.spawn.padAfterLevels=o;var p=null!=(s=null==(u=this.scrollCtrl)?void 0:u.offset)?s:0,f=this.getMaxScrollableOffset();this.scrollCtrl&&p>f&&this.scrollCtrl.scrollToHeight(f,{duration:0}),this.layoutByOffset(null!=(c=null==(h=this.scrollCtrl)?void 0:h.offset)?c:0)}}}},u.waitUntilFirstLevelImagesLoaded=function(){var e=o(s().mark((function e(t){var i,n,r,l,a,o,u,c,h=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(void 0===t&&(t=5e3),i=[],n=0;n<this.per;n++)l=this.getPieceFor(0,n),(a=null==l||null==(r=l.file)?void 0:r.trim())&&i.push(a);if(i.length){e.next=5;break}return e.abrupt("return");case 5:return o=Array.from(new Set(i)),u=Promise.all(o.map((function(e){return h.preloadTexture(e)}))),c=new Promise((function(e){setTimeout((function(){return e()}),t)})),e.next=10,Promise.race([u,c]);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),u.applyPieceTextFromApi=function(e,t,i){var n,r=this._getNodeCache(e);r.bindings||(r.bindings=e.getComponentsInChildren(m));for(var l=null!=(n=null==t?void 0:t.name)?n:"",a=0,o=r.bindings;a<o.length;a++){o[a].updateFromApi({title:l,name:l})}e.__piece=null!=t?t:null,e.__gidx=i,e.__displayName=l},u.applySideImageOrPlaceholder=function(e,t,i,n){var r=this._getNodeCache(e),l=this.lib;r.bindings||(r.bindings=e.getComponentsInChildren(m));for(var a=n&&null!=t&&t.file?t.file:null,o=0,s=r.bindings;o<s.length;o++){var u,c=s[o];null==l||l.applySideUrlOrThemeToBinding(c,a,null!=(u=null==t?void 0:t.hex_color)?u:null,i,this.spawn.rngSeedColors>>>0)}},u.anyToStringOrNull=function(e){if(null==e)return null;var t=String(e).trim();return t||null},u.forceApplyMediaForLevel0=function(){for(var e=0;e<this.per;e++){var t=this.findNodeByLevelSlot(0,e),i=this.getPieceFor(0,e);if(t&&i){var n=this.globalIndexOf(0,e);this.applyPieceTextFromApi(t,i,n),this.applySideImageOrPlaceholder(t,i,n,!0)}}},u.mulberry32=function(e){return function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}},u.fisherYatesShuffle=function(e,t){for(var i=e.length-1;i>0;i--){var n=Math.floor(t()*(i+1)),r=[e[n],e[i]];e[i]=r[0],e[n]=r[1]}},a(t,[{key:"lib",get:function(){var e;return null!=(e=null==y?void 0:y.instance)?e:null}},{key:"per",get:function(){return Math.max(1,this.spawn.objectsPerLevel)}},{key:"vis",get:function(){return Math.max(1,this.spawn.visibleLevels)}},{key:"basePieceScale",get:function(){return this.spawn.targetVisualScale/Math.max(1e-6,this.spawn.baseScale)}},{key:"levelStep",get:function(){return this.spawn.baseHeight*this.spawn.baseScale*this.basePieceScale+this.spawn.levelPaddingVisual}}]),t}(b)).EPS=1e-5,ze=t((Ne=Re).prototype,"spawn",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ve}}),Be=t(Ne.prototype,"scrollCtrl",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oe=t(Ne.prototype,"Falenames",[_e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return["Алиса","Борис","Вика","Гриша","Даша","Егор","Жанна","Зоя","Илья","Катя","Лёва","Мила","Никита","Оля","Паша","Рита","Света","Таня","Федя","Юля","Яна"]}}),De=t(Ne.prototype,"imagesPerFrame",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Fe=Ne))||Fe));u._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});